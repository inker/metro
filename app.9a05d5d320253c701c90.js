(self.webpackChunkmetro_map=self.webpackChunkmetro_map||[]).push([[143],{3236:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>Wt});var n=s(5243),o=s.n(n),r=s(2829),i=s(1966),a=s(5325),c=s(3955),l=s(4753);const h=s(8306)((function(t,e){const s=t>9?t:t>8?9.5:9,n=.5*(s-7),o=s<e?1.25*n:1.1*n,r=s<e?.4*o:.6*o;return{lineWidth:n,lightLineWidth:.75*n,circleRadius:o,circleBorder:r,dummyCircleRadius:2*o,transferWidth:.9*n,transferBorder:1.4*r,fullCircleRadius:o+r/2}}),((...t)=>t.join(":")));var d=s(928),u=s(1907),p=s(951),m=s(9937);const f=100..toString(),g="src-ui-DistanceMeasure-___styles__dashed-line___WpsZg";class y{constructor(){this.polyline=o().polyline([],{color:"red"}),this.markers=o().featureGroup(),this.dashedLine=o().polyline([],{color:"red",opacity:.5,dashArray:"0,9",className:g}),this.showDashedLine=()=>{this.dashedLine.setStyle({opacity:.5})},this.hideDashedLine=()=>{this.dashedLine.setStyle({opacity:0})},this.handleDrag=()=>{this.dashedLine.setStyle({opacity:0}),this.updateDistances()},this.onCircleClick=t=>{0===t.originalEvent.button&&(this.markers.removeLayer(t.target),0!==this.markers.getLayers().length?(this.updateDistances(),this.map.hasLayer(this.dashedLine)||this.showDashedLine()):this.fireClearMeasurements())},this.makeMarker=t=>{if(0!==t.originalEvent.button)return;const e=o().marker(t.latlng,{draggable:!0}).setIcon((t=>{const e=(0,m.rS)("svg");e.setAttribute("width",f),e.setAttribute("height",f);const s=(0,m.Q6)((0,n.point)(50,50),40),{style:o}=s;o.stroke="red",o.strokeWidth="20px",o.fill="white",e.appendChild(s);const r=2*t;return(0,n.icon)({iconUrl:(0,p.svgToDataUrl)(e),iconSize:[r,r],iconAnchor:[t,t],popupAnchor:[0,-t]})})(5)).bindPopup("").on("mouseover",this.hideDashedLine).on("mouseout",this.showDashedLine).on("drag",this.handleDrag).on("click",this.onCircleClick);this.markers.addLayer(e),this.updateDistances()},this.resetDashedLine=t=>{const e=this.dashedLine.getLatLngs();e[1]=t.latlng,this.dashedLine.setLatLngs(e),this.dashedLine.redraw()},this.fireClearMeasurements=()=>{this.map.fire("clearmeasurements")},this.clearMeasurements=()=>{this.map.getPanes().overlayPane.style.zIndex="-1000",this.map.removeLayer(this.polyline).removeLayer(this.markers.clearLayers()).removeLayer(this.dashedLine).off("mousemove",this.resetDashedLine).off("click",this.makeMarker)}}onAdd(t){return this.map=t,t.fireEvent("distancemeasureinit"),t.on("measuredistance",(e=>this.measureDistance(t.mouseEventToLatLng(e)))),t.on("clearmeasurements",this.clearMeasurements),this}onRemove(t){}addTo(t){return this.onAdd(t),this}updateDistances(){const t=this.polyline.getLatLngs(),e=this.markers.getLayers(),s=e.length;t[0]=e[0].setPopupContent("0").getLatLng();for(let n=1,o=0;n<s;++n){const s=e[n].getLatLng();t[n]=s,o+=e[n-1].getLatLng().distanceTo(s);const r=Math.round(o),i=r<1e3?`${r} m`:(r<1e4?r/1e3:Math.round(r/10)/100)+" km",a=e[n];a.setPopupContent(i);const c=a.getPopup();if(!c)throw new Error("no popup exists for some reason");c.options.closeButton=!1}t.length>s&&(t.length=s);const n=this.dashedLine.getLatLngs();n[0]=d(t),this.dashedLine.setLatLngs(n),this.polyline.setLatLngs(t),this.polyline.redraw(),this.openLastMarkerPopup()}openLastMarkerPopup(){const t=this.markers.getLayers();if(t.length<2)return;const e=d(t);e&&e instanceof o().Marker&&e.openPopup()}measureDistance(t){this.map.getPanes().overlayPane.style.zIndex="",this.map.addLayer(this.polyline.setLatLngs([])).addLayer(this.markers).addLayer(this.dashedLine.setLatLngs([])).on("click",this.makeMarker).on("mousemove",this.resetDashedLine).fire("click",{latlng:t,originalEvent:{button:0}}),(0,u.No)(this.fireClearMeasurements)}}var w=s(2988),v=s(7361);const b="src-ui-SvgOverlay-___styles__overlay___QkkD6";var k=s(2729),L=s(5079);const x="src-ui-ContextMenu-___styles__contextmenu___xF7Vs";class _{constructor(t){this.handler=t=>{const{target:e}=t;console.log("target",e,e.parentNode);const{className:s}=e;if(!e||"string"==typeof s&&s.includes("leaflet-control"))return;t.preventDefault(),(0,L.NH)(this.container);for(const t of this.items){if(t.trigger&&!t.trigger(e)){console.log(t.trigger(e));continue}const s=document.createElement("div");t.extra&&t.extra.disabled?s.setAttribute("disabled",""):s.dataset.event=t.event,s.textContent=t.text,this.container.appendChild(s)}this.container.onclick=e=>{const s=e.target.getAttribute("data-event");s&&(this.hide(),this.map.fireEvent(s,{clientX:a,clientY:c,relatedTarget:t.target}))};const{width:n,height:o}=this.container.getBoundingClientRect(),{clientWidth:r,clientHeight:i}=document.documentElement,{clientX:a,clientY:c}=t,l=a+n>r?r-n:a,h=c+o>i?c-o:c;this.container.style.transform=`translate(${l}px, ${h}px)`,this.show()},this.show=()=>{this.container.style.visibility="visible",n.Browser.mobile&&this.map.dragging.disable()},this.hide=()=>{this.container.style.visibility="hidden",n.Browser.mobile&&this.map.dragging.enable()},this.items=t,this.container=document.createElement("div"),this.container.classList.add(x),this.container.addEventListener("contextmenu",(t=>{t.preventDefault(),t.target.click()}))}addTo(t){return this.onAdd(t),this}onAdd(t){if(this.map=t,void 0===t)throw new Error("cannot add map editor to metro map: leaflet map is missing");const e=t.getContainer();e.addEventListener("contextmenu",this.handler),e.addEventListener("mousedown",this.hide),e.addEventListener("touchstart",this.hide),n.Browser.mobile||t.on("movestart",this.hide),document.body.appendChild(this.container)}onRemove(t){}insertItem(t,e,s,n,o){const r={event:t,text:e,trigger:s,extra:n};void 0===o||o<0?this.items.push(r):this.items.splice(o,0,r)}removeItem(t,e=!1){if(e)return void k(this.items,(e=>e.event===t));const s=this.items.findIndex((e=>e.event===t));s<0||this.items.splice(s,1)}}var E=s(8891);function B(t,e,s){const n=e*e/s;return n<t?e/s*2+(t-n)/e:2*Math.sqrt(t/s)}const S=t=>t.location||t;var M=s(5352);const C=(t,e)=>n.LatLng.prototype.distanceTo.call(t,e);function D(t,e){if(t.station!==e.station)throw new Error(`platforms (${t.name} & ${e.name} must be on the same station`);const{platforms:s}=t.station,n=new Set(s),o=new Map,r=new Map;for(const t of s)o.set(t,1/0);o.set(t,0);let i=t;for(;n.size>0;){let t=1/0;for(const e of n){const s=(0,M.Hy)(o,e);s<t&&(i=e,t=s)}n.delete(i);const e=i.transfers.map((t=>t.other(i)));for(const t of e){if(!t||!n.has(t))continue;const e=C(i.location,t.location),s=(0,M.Hy)(o,i)+e;s<(0,M.Hy)(o,t)&&(o.set(t,s),r.set(t,i))}}const a=[],c=[];for(i=e;;){const t=r.get(i);if(!t)break;const e=i.transfers.find((e=>e.has(t)));e?(a.push(e),i=t,c.push(i)):console.error("cannot find transfer node")}return c.pop(),{transfers:a.reverse(),midPlatforms:c.reverse()}}const A=(t,e,s)=>{const n=new Map,o=new Map;for(const r of t){const t=r.spans.some((t=>t.routes[0].line.startsWith("E")));let i=C(e,r.location),a=i/1;const c=t?360:240;n.set(r,a+c),i=C(r.location,s),a=i/1,"dummy"!==r.type&&o.set(r,a)}let r=((t,e)=>{const{length:s}=e;if(s<1)throw new Error("an objects array must contain at least 1 object");let n=e[0],o=t.distanceTo(S(n));for(let r=1;r<s;++r){const s=e[r],i=t.distanceTo(S(s));i<o&&(n=s,o=i)}return n})(e,t);const i=new Set(t),a=new Map;for(;i.size>0;){let t=1/0;for(const e of i){const s=(0,M.Hy)(n,e);s<t&&(r=e,t=s)}i.delete(r);const e=[],s=[];for(const t of r.spans){const n=t.other(r);if(!i.has(n))continue;e.push(n);const o=C(r.location,n.location),a=0,c=t.routes[0].line.startsWith("E")?40:25,l=B(o,20,.7);s.push(l+c+a)}for(const t of r.station.platforms){if(!i.has(t))continue;e.push(t);const n=t.spans.some((t=>t.routes[0].line.startsWith("E"))),o=C(r.location,t.location)/2,a=n?360:240;s.push(o/1+a)}for(let t=0,o=e.length;t<o;++t){const o=e[t],i=(0,M.Hy)(n,r)+s[t];i<(0,M.Hy)(n,o)&&(n.set(o,i),a.set(o,r))}}let c=1/0;for(const[t]of n){if("dummy"===t.type)continue;const e=(0,M.Hy)(n,t)+(0,M.Hy)(o,t);e<c&&(c=e,r=t)}const l=C(e,s)/1;if(l<c)return{time:{walkTo:l}};const h=[],u=[r];for(let t=a.get(r);void 0!==t&&void 0!==t;t=a.get(r)){let e;for(const s of r.spans)if(s.has(t)){e=s;break}if(void 0===e)for(const s of r.transfers)if(s.has(t)){e=s;break}if(void 0===e){const{transfers:e,midPlatforms:s}=D(t,r);h.push(...e.reverse()),u.push(...s)}else h.push(e);u.push(t),r=t}u.reverse(),h.reverse();const p=(0,M.Hy)(o,d(u)),m=(0,M.Hy)(n,u[0]);return{platforms:u,edges:h,time:{walkTo:m,metro:c-p-m,walkFrom:p,total:c}}},O="black-glow";function $(t){t.appendChild(function(){const t=(0,m.rS)("filter");return t.id="shadow",t.setAttribute("width","200%"),t.setAttribute("height","200%"),t.innerHTML='\n    <feOffset\n      result="offOut"\n      in="SourceAlpha"\n      dx="0"\n      dy="4"\n    />\n    <feColorMatrix\n      result="matrixOut"\n      in="offOut"\n      type="matrix"\n      values="\n          0 0 0 0   0\n          0 0 0 0   0\n          0 0 0 0   0\n          0 0 0 0.5 0\n      "\n    />\n    <feGaussianBlur\n      result="blurOut"\n      in="matrixOut"\n      stdDeviation="2"\n    />\n    <feBlend\n      in="SourceGraphic"\n      in2="blurOut"\n      mode="normal"\n    />\n  ',t}()),t.appendChild(function(){const t=(0,m.rS)("filter");return t.id=O,t.innerHTML='\n    <feColorMatrix\n      type="matrix"\n      values="\n          0 0 0 0   0\n          0 0 0 0   0\n          0 0 0 0   0\n          0 0 0 0.3 0\n      "\n    />\n    <feGaussianBlur\n      stdDeviation="2.5"\n      result="coloredBlur"\n    />\n    <feMerge>\n      <feMergeNode in="coloredBlur"/>\n      <feMergeNode in="SourceGraphic"/>\n    </feMerge>\n  ',t}()),t.appendChild(function(){const t=(0,m.rS)("filter");return t.id="opacity",t.innerHTML='\n    <feComponentTransfer>\n      <feFuncA type="table" tableValues="0 0.5">\n    </feComponentTransfer>\n  ',t}()),t.appendChild(function(){const t=(0,m.rS)("filter");return t.id="gray",t.innerHTML='\n    <feColorMatrix\n      type="matrix"\n      values="\n        0.2126 0.7152 0.0722 0 0\n        0.2126 0.7152 0.0722 0 0\n        0.2126 0.7152 0.0722 0 0\n        0 0 0 1 0\n      "\n    />\n  ',t}())}function P(t){const e=t.getBoundingClientRect(),s=getComputedStyle(t),n=2*Number.parseFloat(s.strokeWidth||t.style.strokeWidth||"0");e.height>=n&&e.width>=n&&(t.style.filter="url(#black-glow)")}const H=(t,e)=>0===t?"":`${t}${t>1?`${e}s`:e}`,T=t=>{if(void 0===t)return"";if(t<60)return`${Math.round(t)} seconds`;if(t<3570){const e=Math.round(t/60);return H(e,"min")}const e=Math.floor(t/3600),s=Math.floor((t-3600*e)/60);return`${e>0?`${e}h`:""} ${H(s,"min")}`};var N=s(6292),z=s(2659),W=s(8504);const Z=new Set,I=new Set,F=new Set;function R(t,e,s=!1){s?t instanceof SVGCircleElement?function(t,e){Z.add(t),(0,L.VM)(t,(({r:t})=>({r:(+t*e).toString()})))}(t,e):t instanceof SVGRectElement&&function(t,e){I.add(t),(0,L.VM)(t,(({x:t,y:s,width:n,height:o,rx:r,ry:i})=>{const a=+o*(e-1),c=a/2;return{x:(+t-c).toString(),y:(+s-c).toString(),width:(+n+a).toString(),height:(+o*e).toString(),rx:(+r*e).toString(),ry:(+i*e).toString()}}))}(t,e):t.style.transform=`scale(${e})`}function V(t,e){const s=Number.parseFloat((0,L.L7)("transfers-outer").style.strokeWidth||""),n=Number.parseFloat((0,L.L7)("transfers-inner").style.strokeWidth||""),o=(0,M.Hy)(z.Z.outerEdgeBindings,t),r=(0,M.Hy)(z.Z.innerEdgeBindings,t);o.style.strokeDasharray||(F.add(o),o.style.strokeWidth=s*e+"px"),r.style.strokeDasharray||(F.add(r),r.style.strokeWidth=n*e+"px")}const j=n.Browser.webkit&&!n.Browser.mobile;let G=!0,q=null;function Q(){return null===q?Promise.resolve(!0):(G=!1,q)}function U(t,e){return q=async function(t,e){const s=e.length,n=document.getElementById("transfers-outer");for(let o=0;o<s;++o){if(!G)return!1;const s=(0,M.Hy)(z.Z.platformBindings,t[o]);s.style.opacity="",j&&K(s,1.5,200);const r=e[o],i=r instanceof N.FE,a=z.Z.outerEdgeBindings.get(e[o]);if(!a||i&&("osi"===r.type||a.parentNode!==n))continue;const c=z.Z.innerEdgeBindings.get(e[o]),l=a.cloneNode(!0),h=void 0===c?void 0:c.cloneNode(!0),d=(0,L.L7)("paths-outer");d.appendChild(l);const u=(0,L.L7)("paths-inner");h&&u.appendChild(h),P(l);const p=i?.25:1,m=r.source!==t[o],f=[(0,W.default)(l,p,m)];h&&f.push((0,W.default)(h,p,m)),await Promise.all(f),a.style.opacity="",P(a),d.removeChild(l),c&&(c.style.opacity=""),h&&u.removeChild(h)}const o=(0,M.Hy)(z.Z.platformBindings,d(t));return o.style.opacity="",j&&K(o,3,200),!0}(t,e).then((t=>(q=null,G=!0,t))),q}async function K(t,e,s){const{style:n}=t;n.transition=`transform ${s/2}ms linear`,t.getBoundingClientRect(),R(t,e),await(0,u.ld)(t),n.transform="scale(1)",await(0,u.ld)(t),n.transition="",n.transform="none"}const J=s.e(386).then(s.bind(s,7955)),Y=["paths-inner","paths-outer","transfers-inner","transfers-outer","station-circles"].map((t=>`#${t} *`)).join(", ");async function X(t,e=!0){const{platforms:s=[],edges:n,time:o}=t,r=T(o.walkTo),i=(await J).default;if(void 0===n)return i.success(`${r} on foot!`);await Q();for(const{style:t}of document.querySelectorAll(Y))t.filter="initial",t.opacity="0.25";if(!e)return function(t){for(const e of t){if(e instanceof N.FE&&"osi"===e.type)continue;const t=z.Z.outerEdgeBindings.get(e);if(void 0===t)continue;t.style.opacity="";const s=z.Z.innerEdgeBindings.get(e);void 0!==s&&(s.style.opacity=""),e instanceof N.Dr&&P(t)}}(n),void function(t){for(const e of t){const t=z.Z.platformBindings.get(e);t&&(t.style.opacity="")}}(s);if(await U(s,n)){const t=["TIME",`${r} on foot`,`${T(o.metro)} by metro`,`${T(o.walkFrom)} on foot`,`TOTAL: ${T(o.total)}`];i.message(t.join("<br>"),10)}}const tt=(t,e)=>{const s=(0,m.rS)("svg");s.setAttribute("width","20"),s.setAttribute("height","30");const o=(0,n.point)(3,12),r=(0,n.point)(10,29),i=(0,n.point)(17,12),a=(0,m.ny)([r,o,i]);a.style.fill=t;const c=(0,m.Q6)((0,n.point)(10,10),9);if(c.style.fill=t,s.appendChild(a),s.appendChild(c),e){const t=function(t){const e=(0,m.rS)("text");e.setAttribute("x","10"),e.setAttribute("y","14");const{style:s}=e;return s.fill="#fff",s.opacity="1",s.textAnchor="middle",s.fontFamily="Corbel, Verdana, Ubuntu",s.fontSize="12px",e.textContent=t,e}(e);s.appendChild(t)}return(0,n.icon)({iconUrl:(0,p.svgToDataUrl)(s),iconAnchor:r,popupAnchor:o.add(i).divideBy(2)})},et=s.e(386).then(s.bind(s,7955)),st="src-ui-Tooltip-___styles__plate-box___cWV0h";class nt{constructor(){this.element=(0,m.rS)("g"),this._disabled=!1,this._editable=!1;const{element:t}=this;t.style.display="none",t.innerHTML=`\n          <foreignObject\n              x="0"\n              y="0"\n              width="100%"\n              height="100%"\n          >\n              <div class=${st} />\n          </foreignObject>\n      `}get disabled(){return this._disabled}set disabled(t){if(t)this.hide();else{const t=getSelection();t&&t.removeAllRanges()}this._disabled=t}get editable(){return this._editable}set editable(t){const e=t?"true":"false",s=this.element.childNodes[1].children[1].children;for(const t of s)t.contentEditable=e}setFontSize(t){this.element.firstElementChild.firstElementChild.style.fontSize=`${t}px`}show(t,e){if(this.disabled||"none"!==this.element.style.display)return;const s=this.element.firstElementChild,n=s.firstElementChild;n.innerHTML=e.join("<br>"),this.element.setAttribute("transform",`translate(${t.x}, ${t.y})`),this.element.style.display="initial";const{width:o,height:r}=n.getBoundingClientRect();s.setAttribute("transform",`translate(${-o}, ${-r})`)}hide(){this.element.style.display="none"}}const ot={"faq-card":"src-ui-FAQ-___styles__faq-card___cuqeC","cross-ball":"src-ui-FAQ-___styles__cross-ball___LWkHt",question:"src-ui-FAQ-___styles__question___xOBdC",answer:"src-ui-FAQ-___styles__answer___aFsDV"},rt=/\[\[(.+?)\|(.*?)]]/g,it=t=>`\n    <div>\n        <span class="${ot.question}">${t.q}</span>\n        <span class="${ot.answer}">${t.a}</span>\n    </div>\n`;class at{constructor(t){this.showFAQ=()=>{const{card:t,map:e,button:s}=this,{style:o}=t;o.display="inline",o.transform="scale(0.1)",o.opacity="0",t.getBoundingClientRect(),o.transform="none",o.opacity="",s.disabled=!0,n.Browser.mobile||(e.getContainer().classList.add("dimmed"),e.once("mousedown",(()=>{this.hideFAQ()})),(0,u.IH)(window,"keydown").then((t=>{"Escape"===t.key&&e.fireEvent("mousedown")})))},this.hideFAQ=()=>{const{card:t,map:e,button:s}=this,{style:o}=t;t.getBoundingClientRect(),o.transform="scale(0.1)",o.opacity="0",n.Browser.mobile||e.getContainer().classList.remove("dimmed"),(0,u.ld)(t).then((()=>{o.display="initial"})),s.disabled=!1};const e=document.createElement("button");e.textContent="FAQ",e.classList.add("leaflet-control"),e.classList.add(ot["faq-button"]),e.addEventListener("click",this.showFAQ),this.button=e,this.card=document.createElement("div"),this.card.classList.add(ot["faq-card"]),n.Browser.mobile&&s.e(263).then(s.t.bind(s,840,23)).then((t=>{new t.default(this.card).on("swipeleft swiperight",this.hideFAQ)})),this.card.innerHTML+=t.map(it).join("").replace(rt,'<a href="$1" target="_blank" rel="noopener">$2</a>')}addTo(t){this.map=t;const e=document.querySelector(".leaflet-right.leaflet-top");if(document.body.appendChild(this.card),!e)throw new Error("cannot append to .leaflet-right.leaflet-top");return e.appendChild(this.button),this}}const ct=n.Browser.retina&&!n.Browser.mobile,lt=(0,n.tileLayer)(`https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}${ct?"@2x":""}.png`,{id:"inker.mlo91c41",detectRetina:ct,attribution:'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://mapbox.com">Mapbox</a>'}),ht=(0,n.tileLayer)("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{id:"inker/cj9cri11x6cqg2slbyi3o3niq",accessToken:"pk.eyJ1IjoiaW5rZXIiLCJhIjoiajlpYVl1YyJ9.UpoLm3kdL8SCR6GeCRzyIQ",tileSize:512,detectRetina:ct,attribution:'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://mapbox.com">Mapbox</a>'}),dt=(0,n.tileLayer)("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),ut=(0,n.tileLayer)("http://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{attribution:'&copy; Openstreetmap France | &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),pt=(0,n.tileLayer)("http://korona.geog.uni-heidelberg.de/tiles/roads/x={x}&y={y}&z={z}",{attribution:'Imagery from <a href="http://giscience.uni-hd.de/">GIScience Research Group @ University of Heidelberg</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),mt=((0,n.tileLayer)("https://{s}.tile.openstreetmap.se/hydda/base/{z}/{x}/{y}.png",{attribution:'Tiles courtesy of <a href="http://openstreetmap.se/" target="_blank" rel="noopener">OpenStreetMap Sweden</a> &mdash; Map data &copy; <a href="http://server.ts.openstreetmap.org/copyright">OpenStreetMap</a>'}),(0,n.tileLayer)("https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ"}),(0,n.tileLayer)("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}),(0,n.tileLayer)("http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'})),ft=(0,n.tileLayer)("http://i{hash}.wikimapia.org/?x={x}&y={y}&zoom={z}",{hash:t=>t.x%4+t.y%4*4});var gt=s(29);const yt=Date.now(),wt=t=>fetch(`${t}?${yt}`),vt=t=>wt(t).then((t=>t.json()));var bt=s(2358),kt=s(8659),Lt=s(9854),xt=s(1164);function _t(t){let e=t.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(e)return e.slice(1).map(Number);if(!t.startsWith("#"))throw new Error(`invalid css color: ${t}`);if(7===t.length?e=t.match(/[\da-f]{2}/gi):4===t.length&&(e=t.slice(1).split("").map((t=>t+t))),!e)throw new Error(`invalid css color: ${t}`);return e.map((t=>Number.parseInt(t,16)))}function Et(t){const e=t.map(_t);return`#${xt(e,((...t)=>kt(t))).map((t=>Lt(t).toString(16).padStart(2,"0"))).join("")}`}var Bt=s(8446);const St=(t,e)=>{const{platforms:s}=e;if(s.length<3)return[];const{transfers:n}=t;if(3===s.length){return s.every((t=>{return 2===(e=n,s=t,e.filter((t=>t.has(s)))).length;var e,s}))?s:[]}if(4===s.length){const t=s.map((t=>({platform:t,degree:n.filter((e=>e.has(t))).length}))).sort(((t,e)=>t.degree-e.degree)),e=t.map((t=>t.degree)),o=t.map((t=>t.platform));if(Bt(e,[2,2,3,3]))return o;if(Bt(e,[1,2,2,3]))return o.slice(1)}return[]};function Mt(t,e){const s=`rotate(${180*Math.atan2(e.y,e.x)/Math.PI}, 0.5, 0.5)`;t.setAttribute("gradientTransform",s)}function Ct(t,e){t.firstElementChild.setAttribute("offset",e.toString()),t.lastElementChild.setAttribute("offset",(1-e).toString())}function Dt(t,e,s=0){const n=function(t){const e=(0,m.rS)("linearGradient");return e.innerHTML=t.map((t=>`\n        <stop style="stop-color:${t}" />\n    `)).join(""),e}(e);return Ct(n,s),Mt(n,t),n}var At=s(6117),Ot=s(3974),$t=s(2500);function Pt(t,e){const{stroke:s}=e.style;if(!s)return;const n=s.match(/\bvar\((.+?)\)/);if(!n||!n[1])return;const o=t.get(n[1]);o&&(e.style.stroke=o)}const Ht=async t=>{const e=async function(){const t=await wt("res/colors.css"),e=await t.text(),s=/(--[\w-]+?):\s*?(\S.+?);/g,n=[];let o;for(;null!==(o=s.exec(e));)n.push([o[1],o[2]]);return new Map(n)}(),s=function(t){const e=document.createElement("link");return e.rel="stylesheet",e.crossOrigin="",e.href=t,e}(t);document.head.appendChild(s);const n=new Map,o=await e,r=await(0,$t.e5)((()=>s.sheet.cssRules),{interval:100,numAttempts:100});for(const t of r){if(!(t instanceof CSSStyleRule))continue;const e=t.selectorText.split(",").map((t=>t.trim()));for(const s of e){const e=s.match(/^.(M\d+|L|E)$/);e&&e[1]&&(Pt(o,t),n.set(e[1],t.style))}}return console.log(n),n},Tt=s.e(386).then(s.bind(s,7955)),Nt=["paths-outer","paths-inner","transfers-outer","station-circles","transfers-inner","dummy-circles"],zt=[{event:"routefrom",text:"Route from here"},{event:"routeto",text:"Route to here"},{event:"clearroute",text:"Clear route"},{event:"showheatmap",text:"Show heatmap",extra:{disabled:!0}}],Wt=class{constructor(t){this.mediator=new class{constructor(){this.eventListeners=new Map,this.publish=t=>{console.log("event as seen from the dispatcher",t);const{type:e}=t,s=this.eventListeners.get(e);if(void 0===s||0===s.length)return console.log("no event listeners registered for",e),!1;for(const e of s)e(t);return!0}}subscribe(t,e){const s=this.eventListeners.get(t);void 0===s?this.eventListeners.set(t,[e]):s.push(e)}unsubscribe(t,e){const s=this.eventListeners.get(t);if(void 0===s)return;const n=s.indexOf(e);n<0||s.splice(n,1)}},this.moving=!1,this.contextMenu=new _(zt),this.whiskers=new WeakMap,this.platformOffsets=new Map,this.platformsOnSVG=new WeakMap,this.tooltip=new nt,this.config=t,this.makeMap()}getMap(){return this.map}getNetwork(){return this.network}async makeMap(){try{const{config:t}=this,e=this.getGraph(),s=Ht(t.url.scheme),r=vt(t.url.data),i=new Promise((t=>{lt.once("load",t),setTimeout(t,5e3)}));t.center=[0,0];const a={...t},c=o().control.scale({imperial:!1});this.map=o().map(t.containerId,a).addControl(c);const l=this.map.getPanes().mapPane.style;l.visibility="hidden",((t,e)=>{let s=0;window.addEventListener("keydown",(n=>{n.shiftKey&&n.ctrlKey&&"L"===n.key&&(n.preventDefault(),t.removeLayer(e[s]),++s===e.length&&(s=0),t.addLayer(e[s]),t.invalidateSize(!1))}))})(this.map,[lt,dt,ut,ht,pt,mt,ft]),this.addContextMenu();const h=await e;this.network=new N.ZP(h);const d=this.network.platforms.map((t=>t.location)),u=(0,bt.Z)(d);t.center=[u.lat,u.lng];const p=o().latLngBounds(d);this.overlay=new class extends class{constructor(t,e){this.onDoubleClick=t=>{this.mousePos=this.map.mouseEventToContainerPoint(t.originalEvent)},this.onZoomAnim=({target:t,center:e,zoom:s})=>{const{map:n}=this,r=n.getZoom();if(s!==r){const i=n.getZoomScale(s,r),a=n.getCenter();e.equals(a)?this.mousePos=o().point(window.innerWidth/2,window.innerHeight/2).round():this.mousePos||(this.mousePos=v(t,"scrollWheelZoom._lastMousePos")),this.scaleOverlay(i)}this.mousePos=null},this.onZoomEnd=()=>{const{style:t}=this.overlayContainer;t.transform="initial",t.transformOrigin="initial",this.updateOverlayPositioning(),this.map.fireEvent("overlayupdate",this)};const s=w.includes(t)&&"svg"!==t?"http://www.w3.org/1999/xhtml":"http://www.w3.org/2000/svg";this.overlayContainer=document.createElementNS(s,t),this.bounds=e}addTo(t){return this.onAdd(t),this}onAdd(t){this.map=t,this.updateOverlayPositioning();const{markerPane:e,mapPane:s}=t.getPanes();s.insertBefore(this.overlayContainer,e),this.addMapMovementListeners()}onRemove(t){t.getPanes().mapPane.removeChild(this.overlayContainer),this.map.clearAllEventListeners()}addMapMovementListeners(){this.overlayContainer.classList.add("leaflet-zoom-animated"),this.map.on("zoomanim",this.onZoomAnim).on("zoomend",this.onZoomEnd).on("dblclick",this.onDoubleClick)}updateOverlayPositioning(){const{map:t,bounds:e}=this,s=e.getNorthWest(),n=e.getSouthEast();this.topLeft=t.project(s,t.getZoom()).round();const r=o().bounds(t.latLngToLayerPoint(s),t.latLngToLayerPoint(n)),{style:i}=this.overlayContainer,a=r.min;i.left=`${a.x}px`,i.top=`${a.y}px`;const c=r.getSize();i.width=`${c.x}px`,i.height=`${c.y}px`}scaleOverlay(t){const e=this.bounds.getNorthWest(),s=this.map.latLngToContainerPoint(e);if(!this.mousePos){const t=document.documentElement;this.mousePos=o().point(t.clientWidth/2,t.clientHeight/2)}const n=this.mousePos.subtract(s),{style:r}=this.overlayContainer;r.transformOrigin=`${n.x}px ${n.y}px`,r.transform=`scale(${t})`}extendBounds(t){this.bounds.extend(t),this.updateOverlayPositioning()}latLngToOverlayPoint(t){return this.map.project(t,this.map.getZoom()).round().subtract(this.topLeft)}}{constructor(t){super("svg",t),this.defs=(0,m.rS)("defs"),this.origin=(0,m.rS)("g");const{overlayContainer:e}=this;e.classList.add(b),e.appendChild(this.defs),e.appendChild(this.origin)}}(p).addTo(this.map);const{defs:f}=this.overlay;$(f);const{default:g,confirm:k}=await Tt;window.addEventListener("keydown",(async t=>{if(!t.shiftKey||!t.ctrlKey||"r"!==t.key||!await k("Reset network?"))return;const e=await this.getGraph();this.resetNetwork(e)}));const{textContent:L}=f;L||g.alert("\n          Your browser doesn't seem to have capabilities to display some features of the map.\n          Consider using Chrome or Firefox for the best experience.\n        "),this.lineRules=await s,this.resetMapView(),this.map.addLayer(lt),this.map.on("overlayupdate",(()=>{this.moving=!0,this.redrawNetwork(),this.moving=!1})),this.initNetwork(),this.map.invalidateSize(!1),this.addMapListeners(),(new class{constructor(){this.fromMarker=(0,n.marker)([0,0],{draggable:!0,icon:tt("#228822","A")}),this.toMarker=(0,n.marker)([0,0],{draggable:!0,icon:tt("#dd2222","B")}),this.onFromTo=t=>{const e=this.metroMap.getMap(),s=e.mouseEventToLatLng(t),n="routefrom"===t.type?this.fromMarker:this.toMarker;n.setLatLng(s),e.hasLayer(n)||e.addLayer(n);const o=n===this.fromMarker?this.toMarker:this.fromMarker;e.hasLayer(o)&&this.visualizeShortestRoute(!0)},this.clearRoute=async()=>{const t=this.metroMap.getMap(),e=Q();t.removeLayer(this.fromMarker).removeLayer(this.toMarker),(await et).default.dismissAll(),e.then(E.YN)};for(const t of[this.fromMarker,this.toMarker])t.on("drag",(()=>{this.visualizeShortestRoute(!1)})).on("dragend",(()=>{this.visualizeShortestRoute(!0)}))}addTo(t){this.metroMap=t;const{mediator:e}=t,s=t.getMap(),n=s.getCenter();return this.fromMarker.setLatLng(n),this.toMarker.setLatLng(n),((t,e)=>{for(const s of e)t.addLayer(s).removeLayer(s)})(s,[this.fromMarker,this.toMarker]),e.subscribe("routefrom",this.onFromTo),e.subscribe("routeto",this.onFromTo),e.subscribe("clearroute",this.clearRoute),s.on("zoomstart",Q),window.addEventListener("keydown",(t=>{"Escape"===t.key&&e.publish(new Event("clearroute"))})),this}visualizeShortestRoute(t){const e=this.metroMap.getMap();e.hasLayer(this.fromMarker)&&e.hasLayer(this.toMarker)&&this.visualizeRouteBetween(this.fromMarker.getLatLng(),this.toMarker.getLatLng(),t)}async visualizeRouteBetween(t,e,s){(0,E.YN)(),(await et).default.dismissAll(),X(A(this.metroMap.getNetwork().platforms,t,e),s)}}).addTo(this),(new y).addTo(this.map),r.then((t=>new at(t).addTo(this.map))),await i,l.visibility="",this.runUnblur()}catch(t){console.error(t)}}runUnblur(){this.map.on("movestart",(()=>{this.moving=!0})).on("moveend",(()=>{this.moving=!1})),(0,r.Z)({skipIf:()=>this.moving,interval:250})}subscribe(t,e){this.mediator.subscribe(t,e),this.map.on(t,this.mediator.publish)}addContextMenu(){for(const t of zt)this.map.on(t.event,this.mediator.publish);this.contextMenu.addTo(this.map)}addMapListeners(){const{map:t,contextMenu:e}=this;t.on("zoomstart",(()=>{this.tooltip.hide()})),t.on("distancemeasureinit",(()=>{e.insertItem("measuredistance","Measure distance"),t.on("clearmeasurements",(()=>{e.removeItem("clearmeasurements"),e.insertItem("measuredistance","Measure distance")})),this.subscribe("measuredistance",(()=>{e.removeItem("measuredistance"),e.insertItem("clearmeasurements","Clear measurements")}))}))}initNetwork(){const{origin:t}=this.overlay;for(const e of Nt){const s=m.rS("g");s.id=e,t.appendChild(s)}t.insertBefore(this.tooltip.element,document.getElementById("dummy-circles")),this.redrawNetwork(),this.addStationListeners()}resetMapView(){const{center:t,zoom:e}=this.config,s={animate:!1};t?(this.map.setView(t,e+1,s),this.map.setView(t,e,s)):console.error("cannot set map to center")}getGraph(){return vt(this.config.url.graph)}resetNetwork(t){this.network=new N.ZP(t),this.redrawNetwork()}cleanElements(){const{overlay:t,tooltip:e}=this,{element:s}=e;for(const e of t.origin.childNodes)e!==s&&(0,L.NH)(e)}redrawNetwork(){console.time("pre"),this.cleanElements(),this.updatePlatformsPositionOnOverlay(),console.timeEnd("pre"),console.time("preparation");const{detailedZoom:t}=this.config,e=this.map.getZoom(),{lineWidth:s,lightLineWidth:n,circleBorder:o,dummyCircleRadius:r,transferWidth:i,transferBorder:c}=this.getSvgSizes(),l={"station-circles":o,"dummy-circles":0,"transfers-outer":i+c/2,"transfers-inner":i-c/2,"paths-outer":s,"paths-inner":s/2},h=new Map;for(const[t,e]of Object.entries(l))h.set(t,document.createDocumentFragment()),(0,L.L7)(t).style.strokeWidth=`${e}px`;(0,M.Hy)(this.lineRules,"L").strokeWidth=`${n}px`,this.tooltip.setFontSize(Math.max(.5*(e+10),11));const d=new Map;console.timeEnd("preparation"),console.time("circle preparation");const u=(0,M.Hy)(h,"station-circles"),p=(0,M.Hy)(h,"dummy-circles"),f=e>=t;this.platformOffsets.clear();const g=1*s;for(const t of this.network.spans){const{source:e,target:s,routes:n}=t,o=this.network.spans.filter((t=>t.isOf(e,s)));if(1===o.length)continue;if(0===o.length)throw new Error(`some error with span ${e.name}-${s.name}: it probably does not exist`);const r=o.indexOf(t);if(-1===r)throw new Error(`some error with span ${e.name}-${s.name}`);const i=(r-(o.length-1)/2)*g;for(const t of[e,s]){const e=(0,M.Hy)(this.platformsOnSVG,t),s=t.spans.filter((t=>a(t.routes,n).length>0));for(const t of s){(0,M.oH)(this.platformOffsets,e,(()=>new Map)).set(t,i)}}}for(const t of this.network.stations){const s=[];for(const s of t.platforms){const t=(0,M.Hy)(this.platformsOnSVG,s),n=this.makeWhiskers(s);if(this.whiskers.set(s,n),e>9){const e=this.makePlatformElement(s);"dummy"===s.type&&(e.style.display="none"),f&&this.colorizePlatformElement(e,s.passingLines());const n=m.Q6(t,r);u.appendChild(e),z.Z.platformBindings.set(s,e),p.appendChild(n),z.Z.dummyBindings.set(s,n)}}const n=St(this.network,t);if(n.length>0){for(const e of t.platforms)if(n.includes(e)){const t=(0,M.Hy)(this.platformsOnSVG,e);s.push(t)}d.set(t,n)}}console.timeEnd("circle preparation"),console.time("transfer preparation");const y=(0,M.Hy)(h,"transfers-outer"),w=(0,M.Hy)(h,"transfers-inner");for(const t of this.network.transfers){const{source:e,target:s}=t;if(!f&&e.name===s.name)continue;const n=d.get(e.station),o=void 0!==n&&n.includes(e)&&n.includes(s)?this.makeTransferArc(t,n):m.I0((0,M.Hy)(this.platformsOnSVG,e),(0,M.Hy)(this.platformsOnSVG,s));if(z.Z.outerEdgeBindings.set(t,o[0]),z.Z.innerEdgeBindings.set(t,o[1]),"osi"===t.type){o[1].style.display="none";const t=o[0],e=i/1.5;t.style.strokeDasharray=`${i} ${e}`,t.style.strokeWidth=`${i}px`}else o[0].style.stroke=f?this.makeGradient(t):"#000";y.appendChild(o[0]),w.appendChild(o[1])}console.timeEnd("transfer preparation"),console.time("span preparation");const v=(0,M.Hy)(h,"paths-outer"),b=(0,M.Hy)(h,"paths-inner");for(const t of this.network.spans){const[e,s]=this.makePath(t);v.appendChild(e),s&&b.appendChild(s)}console.timeEnd("span preparation"),console.time("appending");for(const[t,e]of h)(0,L.L7)(t).appendChild(e);console.timeEnd("appending")}getSvgSizes(){return h(this.map.getZoom(),this.config.detailedZoom)}makePlatformElement(t){const e=(0,M.Hy)(this.platformsOnSVG,t),{circleRadius:s}=this.getSvgSizes(),n=this.platformOffsets.get(e);if(!n)return m.Q6(e,s);const o=Array.from(n).map((([t,e])=>e)),r=Math.max(...o)-Math.min(...o),i=m.XC(e,r,s),{value:a}=(0,M.Hy)(this.whiskers,t).values().next(),c=180*(0,Ot.EU)(a.subtract(e),Ot.bf)/Math.PI;return i.setAttribute("transform",`rotate(${c})`),i}makeGradient(t){const{source:e,target:s}=t,n=(0,M.Hy)(this.platformsOnSVG,e),o=(0,M.Hy)(this.platformsOnSVG,s),r=[this.getPlatformColor(e),this.getPlatformColor(s)],{fullCircleRadius:i}=this.getSvgSizes(),a=i/n.distanceTo(o),l=o.subtract(n);let h=z.Z.gradientBindings.get(t);return void 0===h?(h=Dt(l,r,a),h.id=c("gradient-"),z.Z.gradientBindings.set(t,h),this.overlay.defs.appendChild(h)):(Mt(h,l),Ct(h,a)),`url(#${h.id})`}updatePlatformsPositionOnOverlay(t=this.map.getZoom()){const{config:e,network:s,overlay:n,platformsOnSVG:o}=this;if(t>=e.detailedZoom)for(const t of s.stations)for(const e of t.platforms){const t=n.latLngToOverlayPoint(e.location);o.set(e,t)}else for(const t of s.stations){const e=new Set,s=n.latLngToOverlayPoint(t.getCenter()),{platforms:r}=t;for(const t of r)e.add(t.name),o.set(t,s);if(1===e.size)continue;if(e.size<1)throw console.error(t),new Error("station has no names");const i=new Map;for(const t of e){const e=r.filter((e=>e.name===t)).map((t=>t.location)),s=(0,bt.Z)(e);i.set(t,n.latLngToOverlayPoint(s))}for(const t of r){const e=(0,M.Hy)(i,t.name);o.set(t,e)}}}getPlatformColor(t){return Et(this.linesToColors(t.passingLines()))}linesToColors(t){const e=[];for(const s of t){const{stroke:t}=(0,M.Hy)(this.lineRules,"M"===s[0]?s:s[0]);t&&e.push(t)}return e}colorizePlatformElement(t,e){if(0!==e.size)if(1!==e.size)t.style.stroke=Et(this.linesToColors(e));else{const s=e.values().next().value;t.classList.add("M"===s[0]?s:s[0])}}makeWhiskers(t){const e=(0,M.Hy)(this.platformsOnSVG,t),s=new Map,{spans:n}=t;if(0===n.length)return s;if(1===n.length)return s.set(n[0],e);if(2===n.length){if(2===t.passingLines().size)return s.set(n[0],e).set(n[1],e);const o=n.map((e=>(0,M.Hy)(this.platformsOnSVG,e.other(t)))),[r,i]=o,a=gt.bU(r,e,i,1),c=.5*Math.min(e.distanceTo(r),e.distanceTo(i));for(let t=0;t<2;++t){const o=a[t].multiplyBy(c).add(e);s.set(n[t],o)}return s}const o=[[],[]],r=[[],[]],i=new WeakMap;for(const s of n){const n=s.other(t),a=(0,M.Hy)(this.platformsOnSVG,n),c=s.source===t?0:1;o[c].push((0,Ot.Fv)(a.subtract(e))),r[c].push(s),i.set(s,e.distanceTo(a))}const[a,c]=o.map((t=>(0,Ot.J6)(t).add(e))),l=gt.bU(a,e,c,1);for(let t=0;t<2;++t){const n=l[t];for(const o of r[t]){const t=.5*(0,M.Hy)(i,o),r=n.multiplyBy(t).add(e);s.set(o,r)}}return s}makeTransferArc(t,e){const{network:s,platformsOnSVG:n}=this,{source:o,target:r}=t,a=(0,M.Hy)(n,o),c=(0,M.Hy)(n,r),l=t=>m.$5(a,c,(0,M.Hy)(n,t));if(3===e.length){return l(i(e,[o,r])[0])}if(o===e[2]&&r===e[3]||o===e[3]&&r===e[2])return m.I0(a,c);const h=[];for(const e of s.transfers)e!==t&&(t.has(e.source)?h.push(e.target):t.has(e.target)&&h.push(e.source));let d;if(2===h.length){if(h[0]!==h[1])throw new Error("FFFFUC");d=h[0]}else{if(3!==h.length)throw new Error("111FUUFF");d=h[0]===h[1]?h[2]:h[0]===h[2]?h[1]:h[0]}return l(d)}makePath(t){const{routes:e,source:s,target:n}=t;if(0===e.length)throw console.error(t,"span has no routes!"),new Error("span has no routes!");const o=e[0].line.match(/([ELM])(\d{0,2})/);if(!o)throw new Error(`match failed for ${s.name}-${n.name}`);const[r,i]=o,a=this.getControlPoints(t),c=(0,At.Ue)(a[0],...a.slice(1));if("E"===i){c.classList.add("E");const e=c.cloneNode(!0);return z.Z.outerEdgeBindings.set(t,c),z.Z.innerEdgeBindings.set(t,e),[c,e]}return void 0!==r&&c.classList.add(r),void 0!==i?c.classList.add(i):c.style.stroke="black",z.Z.outerEdgeBindings.set(t,c),[c]}getControlPoints(t){const{source:e,target:s}=t,n=(0,M.Hy)(this.platformsOnSVG,e),o=(0,M.Hy)(this.platformsOnSVG,s),r=[n,(0,M.Hy)((0,M.Hy)(this.whiskers,e),t),(0,M.Hy)((0,M.Hy)(this.whiskers,s),t),o],i=this.platformOffsets.get(n),a=this.platformOffsets.get(o);if(i){const e=i.get(t);if(!e)return[r];if(a){const t=gt.Vl(r,10),[s,...n]=t.map((t=>gt.qM(t,e)));return[s,...n.map((t=>t.slice(1)))]}const s=gt.pK(r.slice(0,2),e);return r[0]=s[0],r[1]=s[1],[r]}if(a){const e=a.get(t);if(!e)return[r];const s=gt.pK(r.slice(2,4),e);r[2]=s[0],r[3]=s[1]}return[r]}addStationListeners(){const t=(0,L.L7)("dummy-circles");t.addEventListener("mouseover",(t=>{const e=t.target,s=(0,M.yN)(z.Z.dummyBindings,e);this.highlightStation(s.station,(0,E.u1)(s),[s.name])})),t.addEventListener("mouseout",(t=>{this.tooltip.hide(),function(){for(const t of Z)(0,L.We)(t,"r");for(const t of I)(0,L.We)(t,"x","y","width","height","rx","ry");for(const t of F)t.style.strokeWidth="initial";F.clear(),Z.clear(),I.clear(),I.clear()}()}))}highlightStation(t,e,s){const n=t.platforms.filter((t=>s.includes(t.name)));for(const t of n){R((0,M.Hy)(z.Z.platformBindings,t),1.25,!0)}if(this.map.getZoom()>=this.config.detailedZoom)for(const t of this.network.transfers){n.some((e=>t.has(e)))&&s.includes(t.source.name)&&s.includes(t.target.name)&&V(t,1.25)}const o=l(n,(t=>t.location.lat)),r=(0,M.Hy)(z.Z.platformBindings,o);n.some((t=>"dummy"!==t.type))&&this.tooltip.show(m.pW(r),e)}}},2659:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var n=s(251);const o={platformBindings:new WeakMap,dummyBindings:new n.WeakBiMap,outerEdgeBindings:new n.WeakBiMap,innerEdgeBindings:new n.WeakBiMap,gradientBindings:new WeakMap},r=Object.freeze(o)},273:(t,e,s)=>{"use strict";var n=s(5243),o=s(8403);s(3236);const r=JSON.parse('{"containerId":"map-container","minZoom":7,"maxZoom":18,"zoom":11,"detailedZoom":12,"url":{"graph":"https://raw.githubusercontent.com/metrofan/metronetworks/master/{city}/graph.json","data":"res/faq.json","scheme":"https://cdn.jsdelivr.net/gh/metrofan/metronetworks@latest/{city}/scheme.css"},"favicons":{"spb":"https://upload.wikimedia.org/wikipedia/commons/thumb/0/07/Spb_metro_logo.svg/293px-Spb_metro_logo.svg.png","moscow":"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d0/%D0%9B%D0%BE%D0%B3%D0%BE%D1%82%D0%B8%D0%BF_%D0%BC%D0%B5%D1%82%D1%80%D0%BE_%D0%B2_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B5_%D0%B1%D1%80%D0%B5%D0%BD%D0%B4%D0%B0_%D0%BC%D0%BE%D1%81%D0%BA%D0%BE%D0%B2%D1%81%D0%BA%D0%BE%D0%B3%D0%BE_%D1%82%D1%80%D0%B0%D0%BD%D1%81%D0%BF%D0%BE%D1%80%D1%82%D0%B0.svg/199px-%D0%9B%D0%BE%D0%B3%D0%BE%D1%82%D0%B8%D0%BF_%D0%BC%D0%B5%D1%82%D1%80%D0%BE_%D0%B2_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B5_%D0%B1%D1%80%D0%B5%D0%BD%D0%B4%D0%B0_%D0%BC%D0%BE%D1%81%D0%BA%D0%BE%D0%B2%D1%81%D0%BA%D0%BE%D0%B3%D0%BE_%D1%82%D1%80%D0%B0%D0%BD%D1%81%D0%BF%D0%BE%D1%80%D1%82%D0%B0.svg.png","helsinki":"https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/Helsinki_metro_logo_round_edges.svg/240px-Helsinki_metro_logo_round_edges.svg.png","tallinn":"","stockholm":"https://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Stockholm_metro_symbol.svg/240px-Stockholm_metro_symbol.svg.png","qazan":"https://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/Kazan-metro-Logo.svg/240px-Kazan-metro-Logo.svg.png","praha":"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Prag_Metro_Logo.svg/320px-Prag_Metro_Logo.svg.png"}}');if(n.Browser.ie)throw alert("Does not work in your browser (yet)"),new Error("shitty browser");const i=n.Browser.mobile?Promise.resolve().then(s.bind(s,3236)):s.e(735).then(s.bind(s,957)),a=location.search.match(/city=(\w+)/),c=a?a[1]:"spb";for(const t of Object.keys(r.url))r.url[t]=r.url[t].replace(/{city}/g,c);i.then((t=>{new t.default(r)})),document.title=`${c&&"spb"!==c?o(c):"St Petersburg"} metro plan proposal`;document.getElementById("favicon").href=r.favicons[c]},6292:(t,e,s)=>{"use strict";s.d(e,{t4:()=>i,Dr:()=>d,FE:()=>u,ZP:()=>p});var n=s(5243),o=s(7493),r=s(3955);class i{constructor(t,e,s={},n="normal",o){this.id=r("platform-"),this.spans=[],this.transfers=[],this.name=t,this.altNames=s,this.location=e,this.type=n,this.elevation=o}get station(){return this._station}passingRoutes(){const t=new Set;for(const e of this.spans)for(const s of e.routes)t.add(s);return t}passingLines(){const t=new Set;for(const e of this.spans)for(const s of e.routes)t.add(s.line);return t}}var a=s(8891),c=s(2358);class l{constructor(t){this.id=r("station-"),this.platforms=t;for(const e of t)e._station=this}getNames(){return(0,a.BJ)(this.platforms)}getCenter(){return(0,c.Z)(this.platforms.map((t=>t.location)))}passingLines(){const t=new Set;for(const e of this.platforms)for(const s of e.spans)for(const e of s.routes)t.add(e.line);return t}}const h=class{constructor(t,e){if(this.id=r("edge-"),t===e)throw new Error(`source is the same as target: ${t}`);this._source=t,this._target=e}get source(){return this._source}set source(t){this._source=t}get target(){return this._target}set target(t){this._target=t}isOf(t,e){return this._source===t&&this._target===e||this._source===e&&this._target===t}has(t){return this._source===t||this._target===t}other(t){if(this._source===t)return this._target;if(this._target===t)return this._source;throw new Error("span does not have vertex")}isAdjacent(t){return this.has(t._source)||this.has(t._target)}isParallel(t){return t.isOf(this._source,this._target)}invert(){const t=this._source;this._source=this._target,this._target=t}};class d extends h{constructor(t,e,s){super(t,e),t.spans.push(this),e.spans.push(this),this.routes=s}get source(){return this._source}set source(t){void 0!==this._source&&o(this._source.spans,this),this._source=t,t.spans.push(this)}get target(){return this._target}set target(t){void 0!==this._target&&o(this._target.spans,this),this._target=t,t.spans.push(this)}}class u extends h{constructor(t,e,s){super(t,e),t.transfers.push(this),e.transfers.push(this),this.type=s}get source(){return this._source}set source(t){void 0!==this._source&&o(this._source.transfers,this),this._source=t,t.transfers.push(this)}get target(){return this._target}set target(t){void 0!==this._target&&o(this._target.transfers,this),this._target=t,t.transfers.push(this)}}const p=class{constructor(t){this.platforms=t.platforms.map((t=>{return new i(t.name,(e=t.location,(0,n.latLng)(e.lat,e.lng)),t.altNames,t.type);var e})),this.stations=[],this.routes=t.routes,this.lines=t.lines,this.transfers=t.transfers.map((t=>new u(this.platforms[t.source],this.platforms[t.target],t.type)));const e=t=>t.routes.map((t=>this.routes[t]));this.spans=t.spans.map((t=>new d(this.platforms[t.source],this.platforms[t.target],e(t)))),console.time("restore");const s=new Set(this.transfers),o=new Set(this.platforms);for(;s.size>0;){const t=s.values().next().value,e=new Set([t.source,t.target]);s.delete(t);for(const t of e){const n=new Set;for(const o of s)o.source===t?(e.add(o.target),n.add(o)):o.target===t&&(e.add(o.source),n.add(o));for(const t of n)s.delete(t);o.delete(t)}const n=new l(Array.from(e));this.stations.push(n)}for(const t of o)this.stations.push(new l([t]));console.timeEnd("restore")}toJSON(){const{platforms:t,transfers:e,lines:s,spans:n,routes:o}=this;return JSON.stringify({graphVersion:"1.1",platforms:t.map((t=>({name:t.name,altNames:t.altNames,location:t.location,type:"normal"===t.type?void 0:t.type}))),transfers:e.map((e=>({type:e.type,source:t.indexOf(e.source),target:t.indexOf(e.target)}))),lines:s,spans:n.map((e=>({source:t.indexOf(e.source),target:t.indexOf(e.target),routes:e.routes.map((t=>o.indexOf(t)))}))),routes:o},((t,e)=>t.startsWith("_")?void 0:e),2)}deletePlatform(t){console.log("removing platform",t);const{transfers:e,spans:s,station:n}=t;for(const t of e)o(this.transfers,t);if(e.length=0,1===s.length){const e=s[0],n=e.other(t);o(n.spans,e),o(this.spans,e)}else if(2===s.length){const[e,n]=s,r=n.other(t);if(!r)throw new Error("span does not have other end");if(2===t.passingRoutes().size){const s=e.other(t);o(s.spans,e),o(this.spans,e)}else e.source===t?e.source=r:e.target=r;o(r.spans,n),o(this.spans,n)}else for(const e of s){const s=e.other(t);o(s.spans,e),o(this.spans,e)}1===n.platforms.length?o(this.stations,n):o(n.platforms,t),o(this.platforms,t)}}},5352:(t,e,s)=>{"use strict";s.d(e,{jV:()=>o,oH:()=>r,Hy:()=>i,yN:()=>a});var n=s(3560);function o(t,e){const s=new Set;for(const n of t)e.has(n)&&s.add(n);return s}function r(t,e,s){let o=t.get(e);return void 0===o&&(o=n(s)?s():s,t.set(e,o)),o}function i(t,e){const s=t.get(e);if(void 0===s)throw console.error("in map",t,":",e,"->",s),new Error("key or val is undefined");return s}function a(t,e){const s=t.getKey(e);if(void 0===s)throw console.error("in map",t,":",e,"->",s),new Error("key or val is undefined");return s}},5079:(t,e,s)=>{"use strict";s.d(e,{$S:()=>o,NH:()=>r,L7:()=>i,VM:()=>l,We:()=>d});s(2500),s(6557);var n=s(5352);const o=(t,e,s=!1)=>`<a href="${t}" ${s?'target="_blank" rel="noopener"':""}>${e}</a>`;function r(t){let e;for(;e=t.firstChild;)t.removeChild(e)}function i(t){const e=document.getElementById(t);if(!e)throw new Error(`no element with id=${t} exists`);return e}const a=new WeakMap;function c(t,e,s){const o=t.getAttribute(e);if(null===o){if("function"==typeof s)throw new TypeError("cannot invoke on null");return void t.setAttribute(e,s)}if((0,n.oH)(a,t,{})[e]=o,"string"==typeof s)return void t.setAttribute(e,s);const r=s(o);t.setAttribute(e,r)}function l(t,e){const{attributes:s}=t,n={};for(let t=0,e=s.length;t<e;++t){const{name:e,value:o}=s[t];n[e]=o}const o=e(n);for(const[e,s]of Object.entries(o))c(t,e,s)}function h(t,e){const s=a.get(t);if(void 0===s)return;const n=s[e];void 0!==n&&(s[e]=void 0,t.setAttribute(e,n))}function d(t,...e){for(const s of e)h(t,s)}},1907:(t,e,s)=>{"use strict";s.d(e,{IH:()=>n,No:()=>o,ld:()=>r});const n=(t,e)=>new Promise((s=>{t.addEventListener(e,(function n(o){t.removeEventListener(e,n),s(o)}))}));function o(t){const e=e=>{"Escape"===e.key&&(n(),t(e))},s=e=>{n(),t(e)};function n(){removeEventListener("keydown",e,!0),removeEventListener("backbutton",s)}addEventListener("keydown",e,!0),addEventListener("backbutton",s)}const r=t=>n(t,"transitionend")},2358:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var n=s(5243),o=s(7610);const r=t=>(0,n.latLng)(o(t,(t=>t.lat)),o(t,(t=>t.lng)))},6142:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var n=s(8891);const o={spb:"fi",qazan:"tt",helsinki:"se"},r=()=>{const t=(0,n.hw)();return o[t]}},29:(t,e,s)=>{"use strict";s.d(e,{l1:()=>a,Vl:()=>h,pK:()=>d,qM:()=>u,bU:()=>p,f7:()=>m});var n=s(5243),o=s(1175),r=s(928),i=s(3974);const a=t=>Math.abs(t)<=Number.EPSILON,c=(t,e)=>l(((t,e)=>t.slice(1).map(((s,n)=>((t,e,s)=>e.subtract(t).multiplyBy(s).add(t))(t[n],s,e))))(t,e),e),l=(t,e)=>t.length<2?t:[o(t),...c(t,e),r(t)];function h(t,e){if(!((s=e)>0&&Number.isInteger(s)))throw new Error(`k must be a natural number, got ${e} instead`);var s;if(1===e)return[t];const[n,o]=function(t,e){const s=l(t,e),n=s.length>>1;return[s.slice(0,n+1),s.slice(n)]}(t,1/e);return[n,...h(o,e-1)]}function d(t,e){if(2!==t.length)throw new Error("line must have 2 points");if(t[0].equals(t[1]))throw new Error("points are overlapped");const s=t[1].subtract(t[0]),[n]=(0,i.cW)(s),o=(0,i.Fv)(n).multiplyBy(e);return t.map((t=>t.add(o)))}function u(t,e){if(t.length<2)throw new Error("there should be at least 2 control points for an offset");return t.map(((s,n)=>{const o=t[n-1],r=t[n+1];if(!o)return d([s,r],e)[0];if(!r)return d([o,s],e)[1];const[a,c]=d([o,s],e),[l]=d([r,s],-e),h=o.subtract(s),u=r.subtract(s);return(0,i.jV)([a,h],[l,u])||c}))}function p(t,e,s,n=1){const o=t.subtract(e),r=s.subtract(e),a=(0,i.b4)(o,r),c=(0,i.Q8)(o,r)<0?-n:n;return(0,i.cW)(a.multiplyBy(c))}function m(t){if(3!==t.length)throw new Error("must have 3 vertices");const e=t[0],s=t[1].subtract(e),o=t[2].subtract(e),r=(0,i.AK)(s,s),a=(0,i.AK)(o,o),c=(0,i.Q8)(s,o);return Math.abs(c)<Number.EPSILON?null:(0,n.point)(o.y*r-s.y*a,s.x*a-o.x*r).divideBy(2*c).add(e)}},3974:(t,e,s)=>{"use strict";s.d(e,{bf:()=>i,J6:()=>a,AK:()=>c,Q8:()=>l,Fv:()=>h,EU:()=>d,cW:()=>u,b4:()=>p,jV:()=>m});var n,o=s(5243),r=s(29);!function(t){t[t.COLLINEAR=0]="COLLINEAR",t[t.CLOCKWISE=1]="CLOCKWISE",t[t.ANTICLOCKWISE=2]="ANTICLOCKWISE"}(n||(n={}));Object.freeze((0,o.point)(0,0));const i=Object.freeze((0,o.point)(1,0)),a=t=>t.reduce(((t,e)=>t.add(e))).divideBy(t.length),c=(t,e)=>t.x*e.x+t.y*e.y,l=(t,e)=>t.x*e.y-e.x*t.y,h=t=>t.divideBy((t=>Math.sqrt(c(t,t)))(t)),d=(t,e)=>c(t,e)/t.distanceTo(e),u=t=>[(0,o.point)(t.y,-t.x),(0,o.point)(-t.y,t.x)];function p(t,e){const s=h(t),n=h(e),i=s.add(n);return a=i,(0,r.l1)(a.x)&&(0,r.l1)(a.y)?(0,o.point)(0,0):h(i);var a}function m([t,e],[s,n]){const o=l(e,n);if(Math.abs(o)<Number.EPSILON)return null;const r=s.subtract(t),i=l(r,n)/o;return e.multiplyBy(i).add(t)}},8891:(t,e,s)=>{"use strict";s.d(e,{hw:()=>c,YN:()=>l,u1:()=>h,BJ:()=>d});var n=s(4788),o=s(4908),r=s(6557),i=s(6142);s(3974);const a=["paths-inner","paths-outer","transfers-inner","transfers-outer","station-circles"].map((t=>`#${t} > *`)).join(", ");function c(){const t=location.search.match(/city=(\w+)/);return t?t[1]:"spb"}function l(){const t=document.querySelectorAll(a);for(const{style:e}of t)e.opacity="",e.filter="none"}function h(t){const{name:e,altNames:s}=t,n=(0,i.Z)(),o=[e];return n&&s[n]&&o.push(s[n]),s.en&&o.push(s.en),o}function d(t){const e=t.map(h);return n(...e).map((t=>o(t).join(" / "))).filter(r)}},6117:(t,e,s)=>{"use strict";s.d(e,{Rx:()=>i,Ue:()=>a});s(5243);var n=s(9937);const o=["","L","Q","C"];function r(t){const{length:e}=t;if(e>3)throw new Error(`the tail should consist of 1-3 elements, but got ${e} instead`);return`${o[e]} ${t.map((t=>`${t.x} ${t.y}`)).join(" ")}`}function i(t,e,...s){if(e.length<2)throw new Error(`there should be at least 2 control points, but got ${e.length} instead`);const[n,...o]=e;s.unshift(o);const i=s.map(r).join(" ");t.setAttribute("d",`M ${n.x} ${n.y} ${i}`)}function a(t,...e){const s=(0,n.rS)("path");return i(s,t,...e),s}},9937:(t,e,s)=>{"use strict";s.d(e,{rS:()=>a,pW:()=>m,Q6:()=>l,ny:()=>c,XC:()=>d,$5:()=>u,I0:()=>p});var n=s(5243),o=s(3974),r=s(29);function i(t,e,s,n){const{radius:i,large:a,clockwise:c}=function(t,e,s){const n=(0,r.f7)([t,e,s]);if(null===n)return{radius:1/0};const i=t.subtract(s),a=e.subtract(s),c=(0,o.AK)(i,a)<0,l=t.subtract(n),h=e.subtract(n),d=(0,o.Q8)(l,h)>=0;return{radius:n.distanceTo(t),large:c?1:0,clockwise:d&&!c||c&&!d?1:0}}(e,s,n),l=["M",e.x,e.y,...i===1/0?["L"]:["A",i,i,0,a,c],s.x,s.y].join(" ");t.setAttribute("d",l)}const a=t=>document.createElementNS("http://www.w3.org/2000/svg",t);function c(t){const e=a("polygon"),s=t.map((t=>`${t.x},${t.y}`)).join(" ");return e.setAttribute("points",s),e}function l(t,e){const s=a("circle");return s.setAttribute("r",e.toString()),s.setAttribute("cy",t.y.toString()),s.setAttribute("cx",t.x.toString()),s.style.transformOrigin=`${t.x}px ${t.y}px`,s}function h(t,e){const s=a("line");return s.setAttribute("x1",t.x.toString()),s.setAttribute("y1",t.y.toString()),s.setAttribute("x2",e.x.toString()),s.setAttribute("y2",e.y.toString()),s}function d(t,e,s){const n=a("rect");n.setAttribute("x",(t.x-.5*e-s).toString()),n.setAttribute("y",(t.y-s).toString());const o=2*s;return n.setAttribute("width",(e+o).toString()),n.setAttribute("height",o.toString()),n.setAttribute("rx",s.toString()),n.setAttribute("ry",s.toString()),n.style.transformOrigin=`${t.x}px ${t.y}px`,n}function u(t,e,s){const n=function(t,e,s){const n=a("path");return i(n,t,e,s),n}(t,e,s),o=n.cloneNode(!0);return[n,o]}function p(t,e){const s=e.clone();return t.x===e.x?s.x+=.01:t.y===e.y&&(s.y+=.01),[h(t,s),h(t,s)]}const m=t=>t instanceof SVGRectElement?function(t){const e=+t.getAttribute("x")+ +t.getAttribute("width")/2,s=+t.getAttribute("y")+ +t.getAttribute("height")/2,o=(0,n.point)(e,s),r=~~+t.getAttribute("rx"),i=(0,n.point)(0+r,4+r);return o.subtract(i)}(t):function(t){const e=t.getAttribute("cx"),s=t.getAttribute("cy"),o=t.getAttribute("r");if(null===e||null===s||null===o)throw new Error("cx, cy or r does not exist on a circle");const r=(0,n.point)(+e,+s),i=~~o,a=(0,n.point)(0+i,4+i);return r.subtract(a)}(t)}},t=>{"use strict";t.O(0,[202,567,736],(()=>{return e=273,t(t.s=e);var e}));t.O()}]);