webpackJsonp([0],[,function(t,e,r){"use strict";(function(t){function n(t,e){var r=new Set;return t.forEach(function(t){e.has(t)&&r.add(t)}),r}function o(t,e){var r=t.indexOf(e);r<0||(t[r]=L.last(t),t.pop())}function a(t,e){return M.point(+t.x.toFixed(e),+t.y.toFixed(e))}function i(t,e){var r=t.getContainer().getBoundingClientRect(),n=r.top,o=r.left,a=M.point(e.clientX-o,e.clientY-n);return t.containerPointToLatLng(a)}function s(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return t?t.apply(void 0,e):void 0}function u(t){function e(){removeEventListener("keydown",r),removeEventListener("backbutton",n)}var r=function(r){27===r.keyCode&&(e(),t(r))},n=function(r){e(),t(r)};addEventListener("keydown",r),addEventListener("backbutton",n)}function l(){for(var t=document.querySelectorAll(F),e=0,r=t;e<r.length;e++){var n=r[e];n.style.opacity=null,"t"!==n.id[1]&&(n.style.filter=null)}}function c(t,e){var r=document.createEvent("MouseEvents");r.initEvent(e,!0,!0),t.dispatchEvent(r)}function f(t){var e=t.name,r=t.altNames,n=y(),o=[e];return n&&r[n]&&o.push(r[n]),r.en&&o.push(r.en),o}function d(t){return L.zip.apply(void 0,t.map(f)).map(function(t){return L.uniq(t).join(" / ")}).filter(L.identity)}function p(t,e){var r=e.map(function(e){return t.distanceTo(e)}),n=e[1].subtract(e[0]).multiplyBy(r[0]/(r[0]+r[1])).add(e[0]),o=t.subtract(n);return e.map(function(t){return a(t.add(o),2)})}function h(t,e){var r=0;setInterval(function(){return document.title=t[++r%t.length]},e)}function m(t,r,n,o){return void 0===n&&(n=100),void 0===o&&(o=100),k(this,void 0,void 0,function(){var a,i;return x(this,function(s){switch(s.label){case 0:a=0,s.label=1;case 1:return a<o?(i=t(),!r||r(i)?[2,i]:[4,e.delay(n)]):[3,4];case 2:s.sent(),s.label=3;case 3:return++a,[3,1];case 4:throw new Error("rejected")}})})}function v(t,e,r){void 0===e&&(e=100),void 0===r&&(r=100);var n=t.slice(1),o="#"===t[0]?function(){return document.getElementById(n)}:function(){return document.querySelector(t)};return m(o,function(t){return null!==t},e,r)}function g(t){for(var e;e=t.firstChild;)t.removeChild(e)}function y(){var t=location.search.match(/city=(\w+)/),e=t?t[1]:"spb",r={spb:"fi",qazan:"tt",helsinki:"se"};return r[e]}function b(t,e){var r=t.get(e);if(void 0===r)throw console.error("in map",t,":",e,"->",r),new Error("key or val is undefined");return r}function w(t){var e=document.getElementById(t);if(!e)throw new Error("no element with id="+t+" exists");return e}function _(t,e){var r=t.getAttribute(e);if(!r)throw new Error("no attribute "+e+" on element with id="+t.id+" exists");return r}var k=this&&this.__awaiter||function(e,r,n,o){return new(n||(n=t))(function(t,a){function i(t){try{u(o.next(t))}catch(t){a(t)}}function s(t){try{u(o.throw(t))}catch(t){a(t)}}function u(e){e.done?t(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,r||[])).next())})},x=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,a&&(i=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,a=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],a=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,a,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return{next:r(0),throw:r(1),return:r(2)}},M=r(0),L=r(3),E=r(41);e.algorithm=E;var S=r(11);e.geo=S;var C=r(12);e.math=C;var O=r(40);e.Mediator=O.default;var T=r(43);e.sfx=T;var A=r(7);e.svg=A;var G=r(42);e.color=G;var F=["paths-inner","paths-outer","transfers-inner","transfers-outer","station-circles"].map(function(t){return"#"+t+" > *"}).join(", ");e.intersection=n,e.deleteFromArray=o,e.roundPoint=a,e.mouseToLatLng=i,e.callMeMaybe=s,e.once=function(e,r){return new t(function(t){e.addEventListener(r,function n(o){e.removeEventListener(r,n),t(o)})})},e.onceEscapePress=u,e.transitionEnd=function(t){return e.once(t,"transitionend")},e.resetStyle=l,e.triggerMouseEvent=c,e.getPlatformNames=f,e.getPlatformNamesZipped=d,e.midPointsToEnds=p,e.flashTitle=h,e.delay=function(e){return new t(function(t,r){return setTimeout(t,e)})},e.tryDo=m,e.tryGetElement=v,e.removeAllChildren=g,e.getSecondLanguage=y,e.tryGetFromMap=b,e.byId=w,e.attr=_}).call(e,r(2))},,,,,function(t,e,r){"use strict";(function(t){function n(t){return u(this,void 0,void 0,function(){var r,n,o,a,i,s;return l(this,function(u){switch(u.label){case 0:return[4,c.getJSON(t)];case 1:for(r=u.sent(),n=Object.keys(r),o=0,a=n;o<a.length;o++)i=a[o],s=r[i],f.set(i.toLowerCase(),e.userLanguage in s?s[e.userLanguage]:i);return d=new RegExp(n.join("|"),"ig"),[2]}})})}function o(t){var e=f.get(t.toLowerCase());return void 0===e?t:t.toUpperCase()===t?e.toUpperCase():e}function a(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return t.map(function(t){return t.replace(d,o)}).map(function(t,r){return t+(e[r]||"")}).join("")}function i(t,r){return 0===t?"":""+t+(t>1&&"en"===e.userLanguage?r+"s":r)}function s(t){if(void 0===t)return"";if(t<60)return Math.round(t)+" seconds";if(t<3570){var e=Math.round(t/60);return i(e,"min")}var r=Math.floor(t/3600),n=Math.floor((t-3600*r)/60);return(r>0?r+(o=["%hour%"],o.raw=["%hour%"],a(o)):"")+" "+i(n,"min");var o}var u=this&&this.__awaiter||function(e,r,n,o){return new(n||(n=t))(function(t,a){function i(t){try{u(o.next(t))}catch(t){a(t)}}function s(t){try{u(o.throw(t))}catch(t){a(t)}}function u(e){e.done?t(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,r||[])).next())})},l=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,a&&(i=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,a=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],a=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,a,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return{next:r(0),throw:r(1),return:r(2)}},c=r(9);e.userLanguage=navigator.language.slice(0,2).toLowerCase();var f=new Map,d=new RegExp(Object.keys(f).join("|"),"ig");e.updateDictionary=n,e.translate=o,e.tr=a,e.formatTime=s}).call(e,r(2))},function(t,e,r){"use strict";function n(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function o(t,e){var r=n("circle");return r.setAttribute("r",e.toString()),r.setAttribute("cy",t.y.toString()),r.setAttribute("cx",t.x.toString()),r}function a(t,e){var r=n("line");return r.setAttribute("x1",t.x.toString()),r.setAttribute("y1",t.y.toString()),r.setAttribute("x2",e.x.toString()),r.setAttribute("y2",e.y.toString()),r}function i(t,e,r){var o=n("path");return c(o,t,e,r),o}function s(t){var e=[],r=/\D([\d\.]+).*?,.*?([\d\.]+)/g,n=t.getAttribute("d");if(!n)return null;for(var o;null!==(o=r.exec(n));)e.push(v.point(Number(o[1]),Number(o[2])));return e}function u(t,e){if(4!==e.length)throw new Error("there should be 4 points");var r=["M"].concat(e.map(function(t){return t.x+","+t.y}));r.splice(2,0,"C"),t.setAttribute("d",r.join(" "))}function l(t){var e=[],r=/\D([\d\.]+)/g,n=t.getAttribute("d");if(!n)return null;for(var o;null!==(o=r.exec(n));)e.push(Number(o[1]));return e}function c(t,e,r,n){var o=g.getCircumcenter([e,r,n]),a=Math.atan2(e.y-o.y,e.x-o.x),i=Math.atan2(r.y-o.y,r.x-o.x),s=i-a,u=s<=Math.PI||s>-Math.PI?0:1,l=e.subtract(o),c=r.subtract(o),f=g.det(l,c)<0?0:1,d=g.dot(n.subtract(e),n.subtract(r));d<0&&(f=1-f,u=1-u);var p=o.distanceTo(e),h=["M",e.x,e.y,"A",p,p,0,u,f,r.x,r.y].join(" ");t.setAttribute("d",h)}function f(t){var e=n("path");return u(e,t),e}function d(t,e,r){var n=i(t,e,r),o=n.cloneNode(!0);return[n,o]}function p(t,e){var r=e.clone();return t.x===e.x?r.x+=.01:t.y===e.y&&(r.y+=.01),[a(t,r),a(t,r)]}function h(t){var e=v.point(+y.attr(t,"cx"),+y.attr(t,"cy")),r=~~y.attr(t,"r"),n=v.point(0+r,4+r);return e.subtract(n)}function m(t){if(t instanceof SVGPathElement)return t.getTotalLength();var e=v.point(+y.attr(t,"x1"),+y.attr(t,"y1")),r=v.point(+y.attr(t,"x2"),+y.attr(t,"y2"));return e.distanceTo(r)}var v=r(0),g=r(12),y=r(1);e.createSVGElement=n,e.makeCircle=o,e.makeLine=a,e.makeArc=i,e.getBezierPathPoints=s,e.setBezierPath=u,e.getCircularPath=l,e.setCircularPath=c,e.makeCubicBezier=f,e.makeTransferArc=d,e.makeTransferLine=p,e.circleOffset=h,e.getLength=m;var b;!function(t){function e(){var t=n("filter");return t.id="shadow",t.setAttribute("width","200%"),t.setAttribute("height","200%"),t.innerHTML='\n            <feOffset result="offOut" in="SourceAlpha" dx="0" dy="4" />\n            <feColorMatrix result="matrixOut" in="offOut" type="matrix" values=\n                "0 0 0 0   0\n                0 0 0 0   0\n                0 0 0 0   0\n                0 0 0 0.5 0"/>\n            <feGaussianBlur result="blurOut" in="matrixOut" stdDeviation="2" />\n\n            <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />\n        ',t}function r(){var t=n("filter");return t.id=u,t.innerHTML='<feColorMatrix type="matrix" values=\n                "0 0 0 0   0\n                0 0 0 0   0\n                0 0 0 0   0\n                0 0 0 0.3 0"/>\n            <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>\n            <feMerge>\n                <feMergeNode in="coloredBlur"/>\n                <feMergeNode in="SourceGraphic"/>\n            </feMerge>',t}function o(){var t=n("filter");return t.id="opacity",t.innerHTML='<feComponentTransfer>\n            <feFuncA type="table" tableValues="0 0.5">\n        </feComponentTransfer>',t}function a(){var t=n("filter");return t.id="gray",t.innerHTML='<feColorMatrix type="matrix"\n               values="0.2126 0.7152 0.0722 0 0\n                       0.2126 0.7152 0.0722 0 0\n                       0.2126 0.7152 0.0722 0 0\n                       0 0 0 1 0"/>',t}function i(t){t.appendChild(e()),t.appendChild(r()),t.appendChild(o()),t.appendChild(a())}function s(t){var e=t.getBoundingClientRect(),r=getComputedStyle(t),n=2*parseFloat(r.strokeWidth||t.style.strokeWidth||"0");e.height>=n&&e.width>=n&&(t.style.filter="url(#"+u+")")}var u="black-glow";t.makeDrop=e,t.makeGlow=r,t.makeOpacity=o,t.makeGray=a,t.appendAll=i,t.applyDrop=s}(b=e.Filters||(e.Filters={}));var w;!function(t){function e(t){var e=n("linearGradient");if("innerHTML"in e)return e.innerHTML='<stop style="stop-color:'+t[0]+'" /><stop style="stop-color:'+t[1]+'" />',e;var r=n("stop");r.style.stopColor=t[0];var o=n("stop");return o.style.stopColor=t[1],e.appendChild(r),e.appendChild(o),e}function r(t,r,n){void 0===n&&(n=0);var i=e(r);return a(i,n),o(i,t),i}function o(t,e){var r="rotate("+180*Math.atan2(e.y,e.x)/Math.PI+", 0.5, 0.5)";t.setAttribute("gradientTransform",r)}function a(t,e){t.firstChild.setAttribute("offset",e.toString()),t.lastChild.setAttribute("offset",(1-e).toString())}t.makeUndirectedLinear=e,t.makeLinear=r,t.setDirection=o,t.setOffset=a}(w=e.Gradients||(e.Gradients={}))},,function(t,e,r){"use strict";(function(t,n){function o(){return a(this,void 0,void 0,function(){var t,e,r,n,o,a,u,l,c,f;return i(this,function(i){switch(i.label){case 0:return t=document.getElementById("scheme"),[4,s.tryDo(function(){return t.sheet},function(t){return null!==t})];case 1:for(e=i.sent(),r=new Map,n=0,o=e.cssRules;n<o.length;n++)if(a=o[n],a instanceof CSSStyleRule)for(u=0,l=a.selectorText.split(",").map(function(t){return t.trim()});u<l.length;u++)c=l[u],f=c.match(/^.(M\d+|L|E)$/),f&&f[1]&&r.set(f[1],a.style);return console.log(r),[2,r]}})})}var a=this&&this.__awaiter||function(e,r,n,o){return new(n||(n=t))(function(t,a){function i(t){try{u(o.next(t))}catch(t){a(t)}}function s(t){try{u(o.throw(t))}catch(t){a(t)}}function u(e){e.done?t(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,r||[])).next())})},i=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,a&&(i=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,a=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],a=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,a,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return{next:r(0),throw:r(1),return:r(2)}},s=r(1),u=Date.now();e.cachelessFetch=function(t){return n(t+"?"+u)},e.getJSON=function(t){return e.cachelessFetch(t).then(function(t){return t.json()})},e.getLineRules=o}).call(e,r(2),r(18))},function(t,e,r){"use strict";var n=function(){function t(t,e){if(t===e)throw new Error("source is the same as target: "+t);this._source=t,this._target=e}return Object.defineProperty(t.prototype,"source",{get:function(){return this._source},set:function(t){this._source=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t},enumerable:!0,configurable:!0}),t.prototype.isOf=function(t,e){return this._source===t&&this._target===e||this._source===e&&this._target===t},t.prototype.has=function(t){return this._source===t||this._target===t},t.prototype.other=function(t){if(this._source===t)return this._target;if(this._target===t)return this._source;throw new Error("span does not have vertex")},t.prototype.isAdjacent=function(t){return this.has(t._source)||this.has(t._target)},t.prototype.invert=function(){t=[this._target,this._source],this._source=t[0],this._target=t[1];var t},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},function(t,e,r){"use strict";function n(t,e){var r=e.length;if(r<1)throw new Error("an objects array must contain at least 1 object");for(var n=e[0],o=t.distanceTo(n.location||n),a=1;a<r;++a){var i=e[a],s=t.distanceTo(i.location||i);s<o&&(n=i,o=s)}return n}function o(t,e,r,n){void 0===n&&(n=!1);var o=e.map(function(e){return{item:e,distance:t.distanceTo(e.location)}}).filter(function(t){return t.distance<=r});return n&&o.sort(function(t,e){return t.distance-e.distance}),o.map(function(t){return t.item})}function a(t){return s.latLng(u.meanBy(t,function(t){return t.lat}),u.meanBy(t,function(t){return t.lng}))}function i(t,e,r,n){void 0===r&&(r=1e-5);var o=a(t),i=e(o);l.callMeMaybe(n,o);for(var u=10;u>r;u*=.61803398875)for(var c=u,f=-c;f<=c;f+=u)for(var d=-c;d<=c;d+=u){var p=s.latLng(o.lat+f,o.lng+d),h=e(p);h<i&&(o=p,i=h,l.callMeMaybe(n,o))}return o}var s=r(0),u=r(3),l=r(1);e.findClosestObject=n,e.findObjectsWithinRadius=o,e.getCenter=a,e.calculateGeoMean=i},function(t,e,r){"use strict";function n(t){return Math.abs(t.x)<Number.EPSILON||Math.abs(t.y)<Number.EPSILON}function o(t,e){return t.x*e.x+t.y*e.y}function a(t,e){return t.x*e.y-e.x*t.y}function i(t){return t.divideBy(Math.sqrt(o(t,t)))}function s(t,e){var r=i(t),o=i(e),a=r.add(o);return n(a)?v.point(0,0):i(a)}function u(t,e){var r=e.subtract(t);return[v.point(r.y,-r.x),v.point(-r.y,r.x)]}function l(t,e,r,n){void 0===n&&(n=1);var o=t.subtract(e),i=r.subtract(e),l=s(o,i),c=a(o,i)<0?-n:n;return u(e,l.multiplyBy(c).add(e))}function c(t,e){return o(t,e)/t.distanceTo(e)}function f(t){return t.reduce(function(t,e){return t.add(e)}).divideBy(t.length)}function d(t){if(3!==t.length)throw new Error("must have 3 vertices");var e=t[0],r=t[1].subtract(e),n=t[2].subtract(e),i=o(r,r),s=o(n,n);return v.point(n.y*i-r.y*s,r.x*s-n.x*i).divideBy(2*a(r,n)).add(e)}function p(t,e,r){return v.point(t.x+e*Math.cos(r),t.y+e*Math.sin(r))}function h(t){var e=Math.abs(t.x),r=Math.abs(t.y);return t.divideBy(e<r?r:e)}function m(t,e,r){var n=e*e/r;return n<t?e/r*2+(t-n)/e:2*Math.sqrt(t/r)}var v=r(0);e.isArbitrarilySmall=n,e.dot=o,e.det=a,e.normalize=i,e.bisect=s,e.orthogonal=u,e.wings=l,e.angle=c,e.mean=f,e.getCircumcenter=d,e.polarToCartesian=p,e.vectorToGradCoordinates=h,e.timeToTravel=m},,function(t,e,r){"use strict";var n=r(54),o={platformBindings:new WeakMap,dummyBindings:new n.WeakBiMap,outerEdgeBindings:new n.WeakBiMap,innerEdgeBindings:new n.WeakBiMap,gradientBindings:new WeakMap};Object.defineProperty(e,"__esModule",{value:!0}),e.default=Object.freeze(o)},function(t,e,r){"use strict";var n=r(0),o=r(26);e.Platform=o.default;var a=r(28);e.Station=a.default;var i=r(10);e.Edge=i.default;var s=r(27);e.Span=s.default;var u=r(29);e.Transfer=u.default;var l=r(1),c=function(){function t(t){var e=this,r=function(t){return n.latLng(t.lat,t.lng)};this.platforms=t.platforms.map(function(t){return new o.default(t.name,r(t.location),t.altNames)}),this.stations=[],this.routes=t.routes,this.lines=t.lines,this.transfers=t.transfers.map(function(t){return new u.default(e.platforms[t.source],e.platforms[t.target])});var i=function(t){return t.routes.map(function(t){return e.routes[t]})};this.spans=t.spans.map(function(t){return new s.default(e.platforms[t.source],e.platforms[t.target],i(t))}),console.time("restore");for(var l=new Set(this.transfers),c=new Set(this.platforms);l.size>0;){var f=l.values().next().value,d=(new Set).add(f.source).add(f.target);l.delete(f);for(var p=d.values(),h=p.next().value;void 0!==h;h=p.next().value){for(var m=new Set,v=l.values(),g=v.next().value;void 0!==g;g=v.next().value)g.source===h?(d.add(g.target),m.add(g)):g.target===h&&(d.add(g.source),m.add(g));m.forEach(function(t){return l.delete(t)}),c.delete(h)}var y=new a.default(Array.from(d));this.stations.push(y)}c.forEach(function(t){return e.stations.push(new a.default([t]))}),console.timeEnd("restore")}return t.prototype.toJSON=function(){var t=this;return JSON.stringify({platforms:this.platforms.map(function(t){return{name:t.name,altNames:t.altNames,location:t.location}}),transfers:this.transfers.map(function(e){return{source:t.platforms.indexOf(e.source),target:t.platforms.indexOf(e.target)}}),lines:this.lines,spans:this.spans.map(function(e){return{source:t.platforms.indexOf(e.source),target:t.platforms.indexOf(e.target),routes:e.routes.map(function(e){return t.routes.indexOf(e)})}}),routes:this.routes},function(t,e){return t.startsWith("_")?void 0:e})},t.prototype.deletePlatform=function(t){console.log("removing platform",t);for(var e=0,r=t.transfers;e<r.length;e++){var n=r[e];l.deleteFromArray(this.transfers,n)}if(t.transfers.length=0,1===t.spans.length){var o=t.spans[0],a=o.other(t);l.deleteFromArray(a.spans,o),l.deleteFromArray(this.spans,o)}else if(2===t.spans.length){var i=t.spans,s=i[0],u=i[1],c=u.other(t);if(!c)throw new Error("span does not have other end");if(2===t.passingRoutes().size){var f=s.other(t);l.deleteFromArray(f.spans,s),l.deleteFromArray(this.spans,s)}else s.source===t?s.source=c:s.target=c;l.deleteFromArray(c.spans,u),l.deleteFromArray(this.spans,u)}else for(var d=0,p=t.spans;d<p.length;d++){var o=p[d],a=o.other(t);l.deleteFromArray(a.spans,o),l.deleteFromArray(this.spans,o)}var h=t.station;1===h.platforms.length?l.deleteFromArray(this.stations,h):l.deleteFromArray(h.platforms,t),l.deleteFromArray(this.platforms,t)},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=c},function(t,e,r){"use strict";var n=r(0),o=r(33);e.RedCircle=o.default,e.start=n.icon({iconUrl:"https://proxy-antonv.rhcloud.com/?url=http://map.project-osrm.org/images/marker-start-icon-2x.png",iconSize:[20,56],iconAnchor:[10,28]}),e.end=n.icon({iconUrl:"https://proxy-antonv.rhcloud.com/?url=http://map.project-osrm.org/images/marker-end-icon-2x.png",iconSize:[20,56],iconAnchor:[10,28]}),e.red=n.icon({iconUrl:"https://proxy-antonv.rhcloud.com/?url=http://harrywood.co.uk/maps/examples/leaflet/marker-icon-red.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowUrl:"https://proxy-antonv.rhcloud.com/?url=http://cdn.leafletjs.com/leaflet/v0.7.7/images/marker-shadow.png",shadowRetinaUrl:"marker-shadow-@2x.png",shadowSize:[41,41],shadowAnchor:[12,41]})},function(t,e,r){"use strict";function n(t,e){var r=f.getSecondLanguage(),n=t.altNames;r?(t.name=e[0],n[r]=e[1],n.en=e[2]):(t.name=e[0],n.en=e[1])}function o(t){var e=t.name,r=t.altNames,o=r.fi,a=r.en,i=a?[e,o,a]:o?[e,o]:[e],s=i.join("|");c.prompt((u=["New name"],u.raw=["New name"],p.tr(u)),s,function(r,o){var a=o.split("|");if(n(t,a),o===s)return c.warning((d=["Name was not changed"],d.raw=["Name was not changed"],p.tr(d)));var u=i.slice(1).join(", "),l=a.slice(1).join(", ");c.success((h=[""," (",") renamed to "," (",")"],h.raw=[""," (",") renamed to "," (",")"],p.tr(h,e,u,a[0],l)));var f=t.station;if(!(f.platforms.length<2)){c.confirm((m=["Rename the entire station?"],m.raw=["Rename the entire station?"],p.tr(m)),function(){for(var t=0,e=f.platforms;t<e.length;t++){var r=e[t];n(r,a)}c.success((i=["The entire station was renamed to ",""],i.raw=["The entire station was renamed to ",""],p.tr(i,o)));var i});var d,h,m}},function(){return c.warning((t=["Name change cancelled"],t.raw=["Name change cancelled"],p.tr(t)));var t});var u}function a(t,e){for(var r=void 0===e?void 0:Array.from(e).map(function(t){return t.line+t.branch}).join("|"),n=new Set,o=prompt("routes",r)||"",a=function(e){var r="M"===e[0]?e.match(/(M\d{0,2})(\w?)/):e.match(/([EL])(.{0,2})/);if(!r)return console.error("incorrect route",e),"continue";var o=r[1],a=r[2],i=t.routes.find(function(t){return t.line===o&&t.branch===a});void 0===i&&(console.log("creating new route"),i={line:o,branch:a},t.routes.push(i)),n.add(i)},i=0,s=o.split("|");i<s.length;i++){var u=s[i];a(u)}return n}function i(t,e){var r=0;addEventListener("keydown",function(n){n.shiftKey&&n.ctrlKey&&76===n.keyCode&&(n.preventDefault(),t.removeLayer(e[r]),++r===e.length&&(r=0),t.addLayer(e[r]),t.invalidateSize(!1))})}function s(t,e){var r=e.filter(function(t){return t.spans[0].routes[0].line.startsWith("M")}).map(function(t){return t.location}),n=function(t){return r.reduce(function(e,r){return e+t.distanceTo(r)},0)},o=l.polyline([],{color:"red"}),a=d.calculateGeoMean(r,n,1,function(t){return o.addLatLng(t)});t.addLayer(o);for(var i=5e3;i<2e4;i+=5e3)l.circle(a,i-250,{weight:1}).addTo(t),l.circle(a,i+250,{weight:1}).addTo(t);var s=(e.filter(function(t){return t.spans[0].routes[0].line.startsWith("E")}).map(function(t){return t.location}),"Glavnyj voxal"),u=e.find(function(t){return t.name===s&&t.spans[0].routes[0].line.startsWith("E")});if(u){var c=u.location;l.circle(c,3e4).addTo(t),l.circle(c,45e3).addTo(t)}}function u(t,e){for(var r=0,n=e;r<n.length;r++){var o=n[r];t.addLayer(o).removeLayer(o)}}var l=r(0),c=r(13),f=r(1),d=r(11),p=r(6),h=r(34);e.MapEditor=h.default;var m=r(32);e.FAQ=m.default;var v=r(37);e.TextPlate=v.default;var g=r(35);e.RoutePlanner=g.default;var y=r(30);e.ContextMenu=y.default;var b=r(31);e.DistanceMeasure=b.default;var w=r(36);e.SvgOverlay=w.default;var _=r(16);e.Icons=_;var k=r(39);e.tileLayers=k,e.platformRenameDialog=o,e.askRoutes=a,e.addLayerSwitcher=i,e.drawZones=s,e.cacheIcons=u},,function(t,e,r){"use strict";(function(t){var n=this&&this.__awaiter||function(e,r,n,o){return new(n||(n=t))(function(t,a){function i(t){try{u(o.next(t))}catch(t){a(t)}}function s(t){try{u(o.throw(t))}catch(t){a(t)}}function u(e){e.done?t(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,r||[])).next())})},o=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,a&&(i=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,a=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],a=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,a,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return{next:r(0),throw:r(1),return:r(2)}},a=r(0),i=r(56),s=r(3),u=r(17),l=r(9),c=r(14),f=r(6),d=r(15),p=r(1),h=u.tileLayers,m=h.mapbox,v=h.mapnik,g=h.osmFrance,y=h.openMapSurfer,b=h.cartoDBNoLabels,w=h.wikimapia,_=p.sfx.Scale,k=p.math.mean,x=p.algorithm.findCycle,M=[{event:"routefrom",text:"Route from here"},{event:"routeto",text:"Route to here"},{event:"clearroute",text:"Clear route"},{event:"showheatmap",text:"Show heatmap",extra:{disabled:!0}}],L=function(){function e(t){this.mediator=new p.Mediator,this.whiskers=new WeakMap,this.platformsOnSVG=new WeakMap,this.config=t,this.makeMap()}return e.prototype.getMap=function(){return this.map},e.prototype.getNetwork=function(){return this.network},e.prototype.makeMap=function(){return n(this,void 0,void 0,function(){var e,r,n,i,s,c,h,_,k,x,M,L,E,S,C=this;return o(this,function(o){switch(o.label){case 0:return e=this.config,r=p.tryGetElement("#scheme").then(function(t){return t.href=e.url.scheme,l.getLineRules()}),n=this.getGraph(),i=new t(function(t){return m.once("load",t)}),s=l.getJSON(e.url.data),e.center=[0,0],c=Object.assign({},e),"1"===a.version[0]&&(c.wheelPxPerZoomLevel=75,c.inertiaMaxSpeed=1500,c.fadeAnimation=!1),this.map=a.map(e.containerId,c).addControl(a.control.scale({imperial:!1})),h=this.map.getPanes().mapPane.style,h.visibility="hidden",u.addLayerSwitcher(this.map,[m,v,g,y,b,w]),addEventListener("keydown",function(t){t.shiftKey&&t.ctrlKey&&82===t.keyCode&&C.getGraph().then(function(t){return C.resetNetwork(t)})}),this.addContextMenu(),[4,n];case 1:return _=o.sent(),this.network=new d.default(_),k=p.geo.getCenter(this.network.platforms.map(function(t){return t.location})),e.center=[k.lat,k.lng],x=a.latLngBounds(this.network.platforms.map(function(t){return t.location})),this.overlay=new u.SvgOverlay(x,a.point(200,200)).addTo(this.map),M=this.overlay.defs,p.svg.Filters.appendAll(M),L=M.textContent,0===(L||"").length&&alert((S=["Your browser doesn't seem to have capabilities to display some features of the map. Consider using Chrome or Firefox for the best experience."],S.raw=["Your browser doesn't seem to have capabilities to display some features of the map. Consider using Chrome or Firefox for the best experience."],f.tr(S))),[4,r];case 2:return E=o.sent(),this.lineRules=E,this.resetMapView(),this.map.addLayer(m),this.map.on("overlayupdate",function(t){C.redrawNetwork()}),this.initNetwork(),this.map.invalidateSize(!1),this.addMapListeners(),(new u.RoutePlanner).addTo(this),(new u.DistanceMeasure).addTo(this.map),a.Browser.mobile||new u.MapEditor(e.detailedZoom).addTo(this),s.then(function(t){return new u.FAQ(t.faq).addTo(C)}),[4,i];case 3:return o.sent(),h.visibility="",[2]}})})},e.prototype.subscribe=function(t,e){this.mediator.subscribe(t,e),this.map.on(t,this.mediator.publish)},e.prototype.addContextMenu=function(){this.contextMenu=new u.ContextMenu(M);for(var t=0,e=M;t<e.length;t++){var r=e[t];this.map.on(r.event,this.mediator.publish)}this.contextMenu.addTo(this.map)},e.prototype.addMapListeners=function(){var t=this,e=function(t){var e=t;return c.default.outerEdgeBindings.getKey(e)||c.default.innerEdgeBindings.getKey(e)},r=function(t){return c.default.dummyBindings.getKey(t)},n=this,o=n.map,a=n.contextMenu;o.on("distancemeasureinit",function(t){a.insertItem("measuredistance","Measure distance")}),o.on("clearmeasurements",function(t){a.removeItem("clearmeasurements"),a.insertItem("measuredistance","Measure distance")}),o.on("zoomstart",function(e){t.plate.hide()}),this.subscribe("measuredistance",function(t){a.removeItem("measuredistance"),a.insertItem("clearmeasurements","Clear measurements")}),this.subscribe("platformrename",function(e){var n=r(e.relatedTarget);t.plate.show(p.svg.circleOffset(e.relatedTarget),p.getPlatformNames(n)),u.platformRenameDialog(n)}),this.subscribe("platformmovestart",function(e){t.plate.disabled=!0}),this.subscribe("platformmove",function(t){var e=r(t.relatedTarget);e.location=p.mouseToLatLng(o,t)}),this.subscribe("platformmoveend",function(e){var n=r(e.relatedTarget);t.plate.disabled=!1,t.plate.show(p.svg.circleOffset(e.relatedTarget),p.getPlatformNames(n))}),this.subscribe("platformadd",function(r){var n=r.detail,a=p.mouseToLatLng(o,n),i=new d.Platform((c=["New station"],c.raw=["New station"],f.tr(c)),a,{});if(t.network.platforms.push(i),void 0!==n.relatedTarget){var s=e(n.relatedTarget),u=s.source===i?"target":"source",l=new d.Span(i,s[u],s.routes);s[u]=i,t.network.spans.push(l)}t.overlay.extendBounds(a),t.resetNetwork(JSON.parse(t.network.toJSON()));var c}),this.subscribe("platformdelete",function(e){var n=r(e.relatedTarget);t.network.deletePlatform(n),t.redrawNetwork()}),this.subscribe("spanroutechange",function(r){if(void 0!==r.relatedTarget){var n=e(r.relatedTarget),o=u.askRoutes(t.network,new Set(n.routes));n.routes=Array.from(o),t.resetNetwork(JSON.parse(t.network.toJSON()))}}),this.subscribe("spaninvert",function(r){if(void 0!==r.relatedTarget){var n=e(r.relatedTarget);n.invert(),t.resetNetwork(JSON.parse(t.network.toJSON()))}}),this.subscribe("spanend",function(e){var r=c.default.dummyBindings.getKey(e.detail.source),n=c.default.dummyBindings.getKey(e.detail.target);a.removeItem("spanend");var o=r.passingRoutes(),i=n.passingRoutes(),s=o.size,l=i.size,f=s>0&&0===l?1===s?o:u.askRoutes(t.network,o):l>0&&0===s?1===l?i:u.askRoutes(t.network,i):u.askRoutes(t.network,p.intersection(o,i));t.network.spans.push(new d.Span(r,n,Array.from(f))),t.resetNetwork(JSON.parse(t.network.toJSON()))}),this.subscribe("spandelete",function(r){if(void 0!==r.relatedTarget){var n=e(r.relatedTarget);p.deleteFromArray(t.network.spans,n),t.resetNetwork(JSON.parse(t.network.toJSON()))}}),this.subscribe("transferend",function(e){var r=c.default.dummyBindings.getKey(e.detail.source),n=c.default.dummyBindings.getKey(e.detail.target);console.log(r,n),a.removeItem("transferend"),t.network.transfers.push(new d.Transfer(r,n)),t.resetNetwork(JSON.parse(t.network.toJSON()))}),this.subscribe("transferdelete",function(e){if(void 0!==e.relatedTarget){var r=e.relatedTarget,n=c.default.outerEdgeBindings.getKey(r)||c.default.innerEdgeBindings.getKey(r);p.deleteFromArray(t.network.transfers,n),t.resetNetwork(JSON.parse(t.network.toJSON()))}}),this.subscribe("editmapstart",function(e){o.getZoom()<t.config.detailedZoom&&o.setZoom(t.config.detailedZoom);var r=function(t){var e=t.parentElement;if(!e)return!1;var r=e.id;return"paths-outer"===r||"paths-inner"===r};a.insertItem("platformaddclick","New station",function(t){return!r(t)});var n=function(t){var e=t.parentElement;return!!e&&"dummy-circles"===e.id};a.insertItem("platformrename","Rename station",n),
a.insertItem("platformdelete","Delete station",n),a.insertItem("spanstart","Span from here",n),a.insertItem("transferstart","Transfer from here",n),a.insertItem("spanroutechange","Change route",r),a.insertItem("spaninvert","Invert span",r),a.insertItem("platformaddtolineclick","Add station to line",r),a.insertItem("spandelete","Delete span",r),a.insertItem("transferdelete","Delete transfer",function(t){var e=t.parentElement;if(!e)return!1;var r=e.id;return"transfers-outer"===r||"transfers-inner"===r})}),this.subscribe("editmapend",function(t){a.removeItem("platformaddclick"),a.removeItem("platformrename"),a.removeItem("platformdelete"),a.removeItem("spanstart"),a.removeItem("transferstart"),a.removeItem("platformaddtolineclick"),a.removeItem("spanroutechange"),a.removeItem("spandelete"),a.removeItem("transferdelete")}),this.subscribe("mapsave",function(e){i.downloadText("graph.json",t.network.toJSON())})},e.prototype.initNetwork=function(){for(var t=this.overlay.origin,e=["paths-outer","paths-inner","transfers-outer","station-circles","transfers-inner","dummy-circles"],r=0,n=e;r<n.length;r++){var o=n[r],a=p.svg.createSVGElement("g");a.id=o,t.appendChild(a)}this.plate=new u.TextPlate,t.insertBefore(this.plate.element,document.getElementById("dummy-circles")),this.redrawNetwork(),this.addStationListeners()},e.prototype.resetMapView=function(){var t=this.config,e=t.center,r=t.zoom,n={pan:{animate:!1},zoom:{animate:!1}};return e?(this.map.setView(e,r+1,n),void this.map.setView(e,r,n)):void console.error("cannot set map to center")},e.prototype.getGraph=function(){return l.getJSON(this.config.url.graph)},e.prototype.resetNetwork=function(t){this.network=new d.default(t),this.redrawNetwork()},e.prototype.cleanElements=function(){for(var t=0,e=this.overlay.origin.childNodes;t<e.length;t++){var r=e[t];r!==this.plate.element&&p.removeAllChildren(r)}},e.prototype.addBindings=function(){for(var t=this.network.platforms,e=c.default.platformBindings,r=c.default.dummyBindings,n=0,o=t;n<o.length;n++){var a=o[n];this.platformToModel(a,[p.tryGetFromMap(e,a),p.tryGetFromMap(r,a)])}},e.prototype.redrawNetwork=function(){console.time("pre"),this.cleanElements(),this.updatePlatformsPositionOnOverlay(),console.timeEnd("pre"),console.time("preparation");for(var t=this.config.detailedZoom,e=this.map.getZoom(),r=e>9?e:e>8?9.5:9,n=.5*(r-7),o=.75*n,a=r<t?1.25*n:n,i=r<t?.4*a:.6*a,u=2*a,l=.9*n,f=1.25*i,d={"station-circles":i,"dummy-circles":0,"transfers-outer":l+f/2,"transfers-inner":l-f/2,"paths-outer":n,"paths-inner":n/2},h=a+i/2,m=new Map,v=0,g=Object.keys(d);v<g.length;v++){var y=g[v];m.set(y,document.createDocumentFragment()),p.byId(y).style.strokeWidth=d[y]+"px"}var b=p.tryGetFromMap(this.lineRules,"L");b.strokeWidth=o+"px";var w=Math.max(.5*(e+10),11),_=s.get(this.plate,"element.firstChild.firstChild.style");_&&(_.fontSize=w+"px");var k=new Map;console.timeEnd("preparation"),console.time("circle preparation");for(var M=p.tryGetFromMap(m,"station-circles"),L=p.tryGetFromMap(m,"dummy-circles"),E=0,S=this.network.stations;E<S.length;E++){for(var C=S[E],O=[],T=0,A=C.platforms;T<A.length;T++){var G=A[T],F=p.tryGetFromMap(this.platformsOnSVG,G);if(e>9){var P=p.svg.makeCircle(F,a);e>=t&&this.colorizePlatformCircle(P,G.passingLines());var B=p.svg.makeCircle(F,u);M.appendChild(P),c.default.platformBindings.set(G,P),L.appendChild(B),c.default.dummyBindings.set(G,B)}this.whiskers.set(G,this.makeWhiskers(G))}var N=x(this.network,C);if(N.length>0){for(var j=0,z=C.platforms;j<z.length;j++){var G=z[j];if(N.includes(G)){var I=p.tryGetFromMap(this.platformsOnSVG,G);O.push(I)}}k.set(C,N)}}console.timeEnd("circle preparation"),console.time("transfer preparation");for(var R=p.tryGetFromMap(m,"transfers-outer"),D=p.tryGetFromMap(m,"transfers-inner"),W=0,V=this.network.transfers;W<V.length;W++){var q=V[W],J=q.source,Z=q.target,H=e>=t;if(H||J.name!==Z.name){var U=k.get(J.station),Q=void 0!==U&&U.includes(J)&&U.includes(Z)?this.makeTransferArc(q,U):p.svg.makeTransferLine(p.tryGetFromMap(this.platformsOnSVG,J),p.tryGetFromMap(this.platformsOnSVG,Z));c.default.outerEdgeBindings.set(q,Q[0]),c.default.innerEdgeBindings.set(q,Q[1]),Q[0].style.stroke=H?this.makeGradient(q,h):"#000",R.appendChild(Q[0]),D.appendChild(Q[1])}}console.timeEnd("transfer preparation"),console.time("span preparation");for(var K=p.tryGetFromMap(m,"paths-outer"),Y=p.tryGetFromMap(m,"paths-inner"),X=0,$=this.network.spans;X<$.length;X++){var tt=$[X],et=this.makePath(tt),rt=et[0],nt=et[1];K.appendChild(rt),nt&&Y.appendChild(nt)}console.timeEnd("span preparation"),console.time("appending"),m.forEach(function(t,e){return p.byId(e).appendChild(t)}),this.addBindings(),console.timeEnd("appending")},e.prototype.makeGradient=function(t,e){var r=t.source,n=t.target,o=p.tryGetFromMap(this.platformsOnSVG,r),a=p.tryGetFromMap(this.platformsOnSVG,n),i=[this.getPlatformColor(r),this.getPlatformColor(n)],u=e/o.distanceTo(a),l=a.subtract(o),f=c.default.gradientBindings.get(t);return void 0===f?(f=p.svg.Gradients.makeLinear(l,i,u),f.id=s.uniqueId("gradient-"),c.default.gradientBindings.set(t,f),this.overlay.defs.appendChild(f)):(p.svg.Gradients.setDirection(f,l),p.svg.Gradients.setOffset(f,u)),"url(#"+f.id+")"},e.prototype.updatePlatformsPositionOnOverlay=function(t){void 0===t&&(t=this.map.getZoom());var e=this,r=e.config,n=e.network,o=e.overlay,a=e.platformsOnSVG;if(t>=r.detailedZoom)for(var i=0,s=n.stations;i<s.length;i++)for(var u=s[i],l=0,c=u.platforms;l<c.length;l++){var f=c[l],d=o.latLngToOverlayPoint(f.location);a.set(f,d)}else for(var h=function(t){for(var e=new Set,r=o.latLngToOverlayPoint(t.getCenter()),n=0,i=t.platforms;n<i.length;n++){var s=i[n];e.add(s.name),a.set(s,r)}if(1===e.size)return"continue";if(e.size<1)throw console.error(t),new Error("station has no names");var u=new Map;e.forEach(function(e){var r=t.platforms.filter(function(t){return t.name===e}).map(function(t){return t.location}),n=p.geo.getCenter(r);u.set(e,o.latLngToOverlayPoint(n))});for(var l=0,c=t.platforms;l<c.length;l++){var s=c[l],f=p.tryGetFromMap(u,s.name);a.set(s,f)}},m=0,v=n.stations;m<v.length;m++){var u=v[m];h(u)}},e.prototype.getPlatformColor=function(t){return p.color.mean(this.linesToColors(t.passingLines()))},e.prototype.linesToColors=function(t){var e=this,r=[];return t.forEach(function(t){var n=p.tryGetFromMap(e.lineRules,"M"===t[0]?t:t[0]).stroke;n&&r.push(n)}),r},e.prototype.colorizePlatformCircle=function(t,e){if(0!==e.size){if(1===e.size){var r=e.values().next().value;return void t.classList.add("M"===r[0]?r:r[0])}t.style.stroke=p.color.mean(this.linesToColors(e))}},e.prototype.makeWhiskers=function(t){var e=this,r=.5,n=p.tryGetFromMap(this.platformsOnSVG,t),o=new Map,a=t.spans;if(0===a.length)return o;if(1===a.length)return o.set(a[0],n);if(2===a.length){if(2===t.passingLines().size)return o.set(a[0],n).set(a[1],n);for(var i=a.map(function(r){return p.tryGetFromMap(e.platformsOnSVG,r.other(t))}),s=i[0],u=i[1],l=p.math.wings(s,n,u,1),c=Math.min(n.distanceTo(s),n.distanceTo(u))*r,f=0;f<2;++f){var d=l[f].multiplyBy(c).add(n);o.set(a[f],d)}return o}for(var h=[[],[]],m=[[],[]],v=new WeakMap,g=0,y=a;g<y.length;g++){var b=y[g],w=b.other(t),_=p.tryGetFromMap(this.platformsOnSVG,w),x=b.source===t?0:1;h[x].push(p.math.normalize(_.subtract(n))),m[x].push(b),v.set(b,n.distanceTo(_))}for(var M=h.map(function(t){return k(t).add(n)}),L=M[0],E=M[1],S=p.math.wings(L,n,E,1),f=0;f<2;++f)for(var C=S[f],O=0,T=m[f];O<T.length;O++){var b=T[O],c=p.tryGetFromMap(v,b)*r,d=C.multiplyBy(c).add(n);o.set(b,d)}return o},e.prototype.makeTransferArc=function(t,e){var r=this.platformsOnSVG,n=t.source,o=t.target,a=p.tryGetFromMap(r,n),i=p.tryGetFromMap(r,o),u=function(t){return p.svg.makeTransferArc(a,i,p.tryGetFromMap(r,t))};if(3===e.length){var l=s.difference(e,[n,o])[0];return u(l)}if(n===e[2]&&o===e[3]||n===e[3]&&o===e[2])return p.svg.makeTransferLine(a,i);for(var c=[],f=0,d=this.network.transfers;f<d.length;f++){var h=d[f];h!==t&&(t.has(h.source)?c.push(h.target):t.has(h.target)&&c.push(h.source))}var m;if(2===c.length){if(c[0]!==c[1])throw Error("FFFFUC");m=c[0]}else{if(3!==c.length)throw new Error("111FUUFF");m=c[0]===c[1]?c[2]:c[0]===c[2]?c[1]:c[0]}return u(m)},e.prototype.makePath=function(t){var e=t.routes,r=t.source,n=t.target,o="",a="",i="";if(e.length>0){var s=t.routes[0].line.match(/([MEL])(\d{0,2})/);if(!s)throw new Error("match failed for "+r.name+"-"+n.name);o=s[0],a=s[1],i=s[2]}else console.error(t,"span has no routes!");var u=[p.tryGetFromMap(this.platformsOnSVG,r),p.tryGetFromMap(p.tryGetFromMap(this.whiskers,r),t),p.tryGetFromMap(p.tryGetFromMap(this.whiskers,n),t),p.tryGetFromMap(this.platformsOnSVG,n)],l=p.svg.makeCubicBezier(u);if("E"===a){l.classList.add("E");var f=l.cloneNode(!0);return c.default.outerEdgeBindings.set(t,l),c.default.innerEdgeBindings.set(t,f),[l,f]}return void 0!==o&&l.classList.add(o),void 0!==a?l.classList.add(a):l.style.stroke="black",c.default.outerEdgeBindings.set(t,l),[l]},e.prototype.addStationListeners=function(){var t=this,e=function(e){t.plate.hide(),_.unscaleAll()},r=p.byId("dummy-circles");r.addEventListener("mouseover",function(e){var r=e.target,n=c.default.dummyBindings.getKey(r),o=n.station;t.highlightStation(o,p.getPlatformNames(n),[n.name])}),r.addEventListener("mouseout",e);var n=function(e){var r=e.target,n=c.default.outerEdgeBindings.getKey(r)||c.default.innerEdgeBindings.getKey(r),o=p.getPlatformNamesZipped([n.source,n.target]);t.highlightStation(n.source.station,o,[n.source.name,n.target.name])},o=p.byId("transfers-outer"),a=p.byId("transfers-inner");o.addEventListener("mouseover",n),a.addEventListener("mouseover",n),o.addEventListener("mouseout",e),a.addEventListener("mouseout",e)},e.prototype.highlightStation=function(t,e,r){for(var n=1.25,o=t.platforms.filter(function(t){return r.includes(t.name)}),a=0,i=o;a<i.length;a++){var s=i[a],u=p.tryGetFromMap(c.default.platformBindings,s);_.scaleCircle(u,n,!0)}if(this.map.getZoom()>=this.config.detailedZoom)for(var l=function(t){o.some(function(e){return t.has(e)})&&r.includes(t.source.name)&&r.includes(t.target.name)&&_.scaleTransfer(t,n)},f=0,d=this.network.transfers;f<d.length;f++){var h=d[f];l(h)}var m=o.reduce(function(t,e){return t.location.lat<e.location.lat?e:t}),v=p.tryGetFromMap(c.default.platformBindings,m);this.plate.show(p.svg.circleOffset(v),e)},e.prototype.platformToModel=function(t,e){var r=this,n=t.location;Object.defineProperty(t,"location",{get:function(){return t._location},set:function(n){t._location=n;for(var o=r.map.getZoom()<r.config.detailedZoom?t.station.getCenter():n,a=r.overlay.latLngToOverlayPoint(o),i=0,s=e;i<s.length;i++){var u=s[i];u.setAttribute("cx",a.x.toString()),u.setAttribute("cy",a.y.toString())}r.whiskers.set(t,r.makeWhiskers(t)),r.platformsOnSVG.set(t,a);for(var l=new Set(t.spans),f=0,d=t.spans;f<d.length;f++){var h=d[f],m=h.other(t);r.whiskers.set(m,r.makeWhiskers(m)),m.spans.forEach(function(t){return l.add(t)})}l.forEach(function(t){var e=[p.tryGetFromMap(r.platformsOnSVG,t.source),p.tryGetFromMap(p.tryGetFromMap(r.whiskers,t.source),t),p.tryGetFromMap(p.tryGetFromMap(r.whiskers,t.target),t),p.tryGetFromMap(r.platformsOnSVG,t.target)],n=c.default.outerEdgeBindings.get(t),o=c.default.innerEdgeBindings.get(t);p.svg.setBezierPath(n,e),o&&p.svg.setBezierPath(o,e)});for(var v=0,g=t.transfers;v<g.length;v++){var y=g[v];y[y.source===t?"source":"target"]=t}}}),t._location=n},e.prototype.transferToModel=function(t,e){var r=this,n=[t.source,t.target],o=e[0].tagName;["source","target"].forEach(function(a,i){Object.defineProperty(t,a,{get:function(){return t["_"+a]},set:function(n){t["_"+a]=n;var u=p.tryGetFromMap(c.default.platformBindings,n),l=parseFloat(getComputedStyle(u).strokeWidth||""),f=+p.attr(u,"r"),d=f/2+l,h=p.tryGetFromMap(r.platformsOnSVG,n);if("line"===o){for(var m=i+1,v=t.other(n),g=0,y=e;g<y.length;g++){var b=y[g];b.setAttribute("x"+m,h.x.toString()),b.setAttribute("y"+m,h.y.toString())}var w=p.tryGetFromMap(c.default.gradientBindings,t),_=p.tryGetFromMap(r.platformsOnSVG,v),k="source"===a?_.subtract(h):h.subtract(_);p.svg.Gradients.setDirection(w,k);var x=d/h.distanceTo(_);p.svg.Gradients.setOffset(w,x)}else{if("path"!==o)throw new TypeError("wrong element type for transfer");for(var M=[],L=0,E=r.network.transfers;L<E.length;L++){var S=E[L];if(t.isAdjacent(S)&&(M.push(S),3===M.length))break}for(var C=new Set,O=0,T=M;O<T.length;O++){var A=T[O];C.add(A.source).add(A.target)}var G=Array.from(C).map(function(t){return r.platformsOnSVG.get(t)});C.forEach(function(t){return G.push(r.platformsOnSVG.get(t))});for(var F=M.map(function(t){return c.default.outerEdgeBindings.get(t)}),P=M.map(function(t){return c.default.innerEdgeBindings.get(t)}),B=0;B<3;++B){var N=M[B],j=F[B],z=P[B],I=p.tryGetFromMap(r.platformsOnSVG,N.source),R=p.tryGetFromMap(r.platformsOnSVG,N.target),D=s.difference(G,[I,R])[0];D&&(p.svg.setCircularPath(j,I,R,D),z.setAttribute("d",p.attr(j,"d")));var w=p.tryGetFromMap(c.default.gradientBindings,N);p.svg.Gradients.setDirection(w,R.subtract(I));var x=d/I.distanceTo(R);p.svg.Gradients.setOffset(w,x)}}}}),t["_"+a]=n[i]})},e}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=L}).call(e,r(2))},,,,,function(t,e,r){var n=r(47);"string"==typeof n&&(n=[[t.i,n,""]]);r(5)(n,{});n.locals&&(t.exports=n.locals)},function(t,e,r){var n=r(48);"string"==typeof n&&(n=[[t.i,n,""]]);r(5)(n,{});n.locals&&(t.exports=n.locals)},function(t,e,r){"use strict";var n=function(){function t(t,e,r,n){void 0===r&&(r={}),this.spans=[],this.transfers=[],this.name=t,this.altNames=r,this.location=e,this.elevation=n}return Object.defineProperty(t.prototype,"station",{get:function(){return this._station},enumerable:!0,configurable:!0}),t.prototype.passingRoutes=function(){for(var t=new Set,e=0,r=this.spans;e<r.length;e++)for(var n=r[e],o=0,a=n.routes;o<a.length;o++){var i=a[o];t.add(i)}return t},t.prototype.passingLines=function(){for(var t=new Set,e=0,r=this.spans;e<r.length;e++)for(var n=r[e],o=0,a=n.routes;o<a.length;o++){var i=a[o];t.add(i.line)}return t},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),o=r(1),a=r(10),i=function(t){function e(e,r,n){var o=t.call(this,e,r)||this;return e.spans.push(o),r.spans.push(o),o.routes=n,o}return n(e,t),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},set:function(t){void 0!==this._source&&o.deleteFromArray(this._source.spans,this),this._source=t,t.spans.push(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){void 0!==this._target&&o.deleteFromArray(this._target.spans,this),this._target=t,t.spans.push(this)},enumerable:!0,configurable:!0}),e}(a.default);Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},function(t,e,r){"use strict";var n=r(1),o=function(){function t(t){this.platforms=t;for(var e=0,r=t;e<r.length;e++){var n=r[e];n._station=this}}return t.prototype.getNames=function(){return n.getPlatformNamesZipped(this.platforms)},t.prototype.getCenter=function(){return n.geo.getCenter(this.platforms.map(function(t){return t.location}))},t.prototype.passingLines=function(){for(var t=new Set,e=0,r=this.platforms;e<r.length;e++)for(var n=r[e],o=0,a=n.spans;o<a.length;o++)for(var i=a[o],s=0,u=i.routes;s<u.length;s++){var l=u[s];t.add(l.line)}return t},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),o=r(1),a=r(10),i=function(t){function e(e,r){var n=t.call(this,e,r)||this;return e.transfers.push(n),r.transfers.push(n),n}return n(e,t),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},set:function(t){void 0!==this._source&&o.deleteFromArray(this._source.transfers,this),this._source=t,t.transfers.push(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){void 0!==this._target&&o.deleteFromArray(this._target.transfers,this),this._target=t,t.transfers.push(this)},enumerable:!0,configurable:!0}),e}(a.default);Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},function(t,e,r){"use strict";var n=r(0),o=r(3),a=r(1),i=r(6),s=r(66),u=function(){function t(t){this.items=t,this.container=document.createElement("div"),this.container.classList.add(s.contextmenu),this.container.addEventListener("contextmenu",function(t){t.preventDefault(),t.target.click()})}return t.prototype.addTo=function(t){return this.onAdd(t),this},t.prototype.onAdd=function(t){var e=this;if(this.map=t,void 0===t)throw new Error("cannot add map editor to metro map: leaflet map is missing");var r=t.getPanes().mapPane,o=t.getContainer(),a=function(t){return e.handler(t)},i=function(t){return e.hide()};r.addEventListener("contextmenu",a,!1),o.addEventListener("mousedown",i),o.addEventListener("touchstart",i),n.Browser.mobile||t.on("movestart",i),document.body.appendChild(this.container)},t.prototype.onRemove=function(t){},t.prototype.handler=function(t){var e=this;t.preventDefault(),console.log("target",t.target,t.target.parentNode),a.removeAllChildren(this.container);for(var r=0,n=this.items;r<n.length;r++){var o=n[r];if(void 0===o.trigger||o.trigger(t.target)){var s=document.createElement("div");void 0!==o.extra&&o.extra.disabled?s.setAttribute("disabled",""):s.setAttribute("data-event",o.event),s.textContent=i.translate(o.text),this.container.appendChild(s)}else console.log(o.trigger(t.target))}this.container.onclick=function(r){var n=r.target,o=n.getAttribute("data-event");o&&(e.hide(),e.map.fireEvent(o,{clientX:h,clientY:m,relatedTarget:t.target}))};var u=this.container.getBoundingClientRect(),l=u.width,c=u.height,f=document.documentElement,d=f.clientWidth,p=f.clientHeight,h=t.clientX,m=t.clientY,v=h+l>d?d-l:h,g=m+c>p?m-c:m;this.container.style.transform="translate("+v+"px, "+g+"px)",this.show()},t.prototype.insertItem=function(t,e,r,n,o){var a={event:t,text:e,trigger:r,extra:n};void 0===o||o<0?this.items.push(a):this.items.splice(o,0,a)},t.prototype.removeItem=function(t,e){if(void 0===e&&(e=!1),e)return void o.remove(this.items,function(e){return e.event===t});var r=this.items.findIndex(function(e){return e.event===t});r<0||this.items.splice(r,1)},t.prototype.show=function(){this.container.style.visibility=null,n.Browser.mobile&&this.map.dragging.disable()},t.prototype.hide=function(){this.container.style.visibility="hidden",n.Browser.mobile&&this.map.dragging.enable()},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=u},function(t,e,r){"use strict";var n=r(0),o=r(3),a=r(1),i=r(16),s=function(){function t(){var t=this;this.polyline=n.polyline([],{color:"red"}),this.markers=n.featureGroup(),this.dashedLine=n.polyline([],{color:"red",opacity:.5,dashArray:"0,9"}),this.makeMarker=function(e){if(0===e.originalEvent.button){var r=function(e){t.dashedLine.setStyle({opacity:0}),t.updateDistances()},o=n.marker(e.latlng,{draggable:!0}).setIcon(i.RedCircle).bindPopup("").on("mouseover",function(e){return t.hideDashedLine()}).on("mouseout",function(e){return t.showDashedLine()}).on("drag",r).on("click",t.onCircleClick.bind(t));t.markers.addLayer(o),t.updateDistances()}},this.resetDashedLine=function(e){t.dashedLine.getLatLngs()[1]=e.latlng,t.dashedLine.redraw()}}return t.prototype.onAdd=function(t){var e=this;return this.map=t,t.fireEvent("distancemeasureinit"),t.on("measuredistance",function(r){return e.measureDistance(a.mouseToLatLng(t,r))}),t.on("clearmeasurements",function(t){return e.clearMeasurements()}),this},t.prototype.onRemove=function(t){},t.prototype.addTo=function(t){return this.onAdd(t),this},t.prototype.updateDistances=function(){var t=this.polyline.getLatLngs(),e=this.markers.getLayers(),r=e.length;t[0]=e[0].setPopupContent("0").getLatLng();for(var n=1,a=0;n<r;++n){var i=e[n].getLatLng();t[n]=i,a+=e[n-1].getLatLng().distanceTo(i);var s=Math.round(a),u=s<1e3?s+" m":(s<1e4?s/1e3:Math.round(s/10)/100)+" km";e[n].setPopupContent(u)}t.length>r&&(t.length=r),this.dashedLine.getLatLngs()[0]=o.last(t),this.polyline.redraw(),r>1&&o.last(e).openPopup()},t.prototype.showDashedLine=function(){this.dashedLine.setStyle({opacity:.5})},t.prototype.hideDashedLine=function(){this.dashedLine.setStyle({opacity:0})},t.prototype.onCircleClick=function(t){if(0===t.originalEvent.button){if(this.markers.removeLayer(t.target),0===this.markers.getLayers().length)return void this.map.fire("clearmeasurements");this.updateDistances(),this.map.hasLayer(this.dashedLine)||this.showDashedLine()}},t.prototype.measureDistance=function(t){var e=this;this.dashedLine.addLatLng(t).addLatLng(t),this.map.addLayer(this.polyline.setLatLngs([])).addLayer(this.markers).addLayer(this.dashedLine.setLatLngs([])).on("click",this.makeMarker).on("mousemove",this.resetDashedLine).fire("click",{latlng:t,originalEvent:{button:0}}),a.onceEscapePress(function(t){return e.map.fire("clearmeasurements")})},t.prototype.clearMeasurements=function(){this.map.removeLayer(this.polyline).removeLayer(this.markers.clearLayers()).removeLayer(this.dashedLine).off("mousemove",this.resetDashedLine).off("click",this.makeMarker)},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=s},function(t,e,r){"use strict";var n=r(0),o=r(58),a=r(1),i=r(67),s=function(){function t(t){var e=this,r=document.createElement("button");r.textContent="FAQ",r.classList.add("leaflet-control"),r.classList.add(i["faq-button"]),r.addEventListener("click",function(t){return e.showFAQ()}),this.button=r,this.card=document.createElement("div"),this.card.classList.add(i["faq-card"]),n.Browser.mobile&&new o(this.card).on("swipeleft swiperight",function(t){return e.hideFAQ()});var a=/\[\[(.+?)\|(.*?)\]\]/g,s='<a href="$1" target="_blank">$2</a>',u=i.question,l=i.answer,c=function(t){return'\n            <div>\n                <span class="'+u+'">'+t.q+'</span>\n                <span class="'+l+'">'+t.a+"</span>\n            </div>\n        "};this.card.innerHTML+=t.map(c).join("").replace(a,s)}return t.prototype.addTo=function(t){this.map=t.getMap();var e=document.querySelector(".leaflet-right.leaflet-top");if(document.body.appendChild(this.card),!e)throw new Error("cannot append to .leaflet-right.leaflet-top");return e.appendChild(this.button),this},t.prototype.showFAQ=function(){var t=this,e=this,r=e.card,o=e.map,i=e.button,s=r.style;s.display="inline",s.transform="scale(0.1)",s.opacity="0",r.getBoundingClientRect(),s.transform=null,s.opacity=null,i.disabled=!0,n.Browser.mobile||(o.getContainer().classList.add("dimmed"),o.once("mousedown",function(e){return t.hideFAQ()}),a.once(window,"keydown").then(function(t){27===t.keyCode&&o.fireEvent("mousedown")}))},t.prototype.hideFAQ=function(){var t=this,e=t.card,r=t.map,o=t.button,i=e.style;e.getBoundingClientRect(),i.transform="scale(0.1)",i.opacity="0",n.Browser.mobile||r.getContainer().classList.remove("dimmed"),a.transitionEnd(e).then(function(t){return i.display=null}),o.disabled=!1},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=s},function(t,e,r){"use strict";var n=r(61),o=r(7),a=o.createSVGElement("svg");a.setAttribute("width","100"),a.setAttribute("height","100");var i=o.makeCircle(L.point(50,50),40);i.style.stroke="red",i.style.strokeWidth="20px",i.style.fill="white",a.appendChild(i);var s=5;Object.defineProperty(e,"__esModule",{value:!0}),e.default=L.icon({iconUrl:n.svgToDataUrl(a),iconSize:[2*s,2*s],iconAnchor:[s,s],popupAnchor:[0,-s]})},function(t,e,r){"use strict";var n=r(59),o=r(3),a=r(6),i=r(1),s=r(68),u=function(){function t(t){var e=this;this.mapEditorStore=n.createInstance({name:"mapEditor"}),this.backupData=o.throttle(this.mapEditorStore.setItem,1e3);var r=document.createElement("button");r.textContent="Edit Map",r.classList.add("leaflet-control"),r.classList.add(s["edit-map-button"]),r.onclick=function(t){return e.editMapClick()},this.button=r}return Object.defineProperty(t.prototype,"editMode",{get:function(){return this._editMode},set:function(t){var e=this,r=this,n=r.button,o=r.metroMap.mediator;if(t){var s=i.byId("dummy-circles");n.textContent=(u=["Save map"],u.raw=["Save map"],a.tr(u)),n.onclick=function(t){return e.saveMapClick()},s.onmousedown=s.onclick=function(){return!1},o.publish(new Event("editmapstart"))}else n.textContent=(l=["Edit map"],l.raw=["Edit map"],a.tr(l)),n.onclick=function(t){return e.editMapClick()},o.publish(new Event("editmapend"));this._editMode=t;var u,l},enumerable:!0,configurable:!0}),t.prototype.addTo=function(t){var e=t.getMap();if(void 0===e)throw new Error("cannot add map editor to metro map: map is missing");this.metroMap=t;var r=document.querySelector(".leaflet-right.leaflet-top");return r?(r.appendChild(this.button),this.editMode=!1):console.error("cannot append to .leaflet-right.leaflet-top"),this},t.prototype.sendEvent=function(t){this.backupData("map",this.metroMap.getNetwork().toJSON()),this.metroMap.mediator.publish(t)},t.prototype.editMapClick=function(){this.editMode=!0,this.addMapListeners()},t.prototype.saveMapClick=function(){this.sendEvent(new Event("mapsave")),this.editMode=!1},t.prototype.addMapListeners=function(){var t,e,r,n=this,o=this.metroMap.getMap(),a=i.byId("dummy-circles");i.byId("paths-outer"),i.byId("paths-inner");a.addEventListener("mousedown",function(a){if(2!==a.button&&r){var i={source:r,target:a.target};n.sendEvent(new CustomEvent("span"===e?"spanend":"transferend",{detail:i})),r=null,e=void 0}else 0===a.button?(o.dragging.disable(),t=a.target,n.sendEvent(new MouseEvent("platformmovestart",{relatedTarget:a.target}))):1===a.button&&n.sendEvent(new MouseEvent("spanstart",{relatedTarget:a.target}))}),o.on("mousemove",function(e){if(t){var r=e.originalEvent,o=r.clientX,a=r.clientY;n.sendEvent(new MouseEvent("platformmove",{relatedTarget:t,clientX:o,clientY:a}))}}).on("mouseup",function(e){t&&(o.dragging.enable(),n.sendEvent(new MouseEvent("platformmoveend",{relatedTarget:t})),t=null)}),this.metroMap.subscribe("spanstart",function(t){e="span",r=t.relatedTarget}),this.metroMap.subscribe("transferstart",function(t){e="transfer",r=t.relatedTarget}),this.metroMap.subscribe("platformaddclick",function(t){var e=t.clientX,r=t.clientY;n.sendEvent(new CustomEvent("platformadd",{detail:{clientX:e,clientY:r}}))}),this.metroMap.subscribe("platformaddtolineclick",function(t){n.sendEvent(new CustomEvent("platformadd",{detail:t}))})},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=u},function(t,e,r){"use strict";var n=r(0),o=r(13),a=r(1),i=r(17),s=a.sfx,u=s.Animation,l=s.visualizeRoute,c=a.algorithm.shortestRoute,f=function(){function t(){var t=this;this.onFromTo=function(e){var r=t.metroMap.getMap(),n=a.mouseToLatLng(r,e),o="routefrom"===e.type?t.fromMarker:t.toMarker;o.setLatLng(n),r.hasLayer(o)||r.addLayer(o);var i=o===t.fromMarker?t.toMarker:t.fromMarker;r.hasLayer(i)&&t.visualizeShortestRoute(!0)},this.clearRoute=function(){var e=t.metroMap.getMap(),r=u.terminateAnimations();e.removeLayer(t.fromMarker).removeLayer(t.toMarker),t.fromMarker.off("drag").off("dragend"),t.toMarker.off("drag").off("dragend"),o.dismissAll(),r.then(a.resetStyle)},this.fromMarker=n.marker([0,0],{draggable:!0,icon:i.Icons.start}),this.toMarker=n.marker([0,0],{draggable:!0,icon:i.Icons.end}),this.addMarkerListeners()}return t.prototype.addTo=function(t){this.metroMap=t;var e=t.mediator,r=t.getMap(),n=r.getCenter();return this.fromMarker.setLatLng(n),this.toMarker.setLatLng(n),i.cacheIcons(r,[this.fromMarker,this.toMarker]),e.subscribe("routefrom",this.onFromTo),e.subscribe("routeto",this.onFromTo),e.subscribe("clearroute",this.clearRoute),r.on("zoomstart",u.terminateAnimations),addEventListener("keydown",function(t){27===t.keyCode&&e.publish(new Event("clearroute"))}),this},t.prototype.addMarkerListeners=function(){for(var t=this,e=0,r=[this.fromMarker,this.toMarker];e<r.length;e++){var n=r[e];n.on("drag",function(e){return t.visualizeShortestRoute(!1)}).on("dragend",function(e){t.visualizeShortestRoute(!0)})}},t.prototype.visualizeShortestRoute=function(t){var e=this.metroMap.getMap();e.hasLayer(this.fromMarker)&&e.hasLayer(this.toMarker)&&this.visualizeRouteBetween(this.fromMarker.getLatLng(),this.toMarker.getLatLng(),t)},t.prototype.visualizeRouteBetween=function(t,e,r){a.resetStyle(),o.dismissAll(),l(c(this.metroMap.getNetwork().platforms,t,e),r)},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=f},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),o=r(0),a=r(38),i=r(7),s=r(69),u=function(t){function e(e,r){void 0===r&&(r=o.point(100,100));var n=t.call(this,e,r)||this;n.defs=i.createSVGElement("defs");var a=i.createSVGElement("g");a.id="origin",a.setAttribute("transform","translate("+n.margin.x+", "+n.margin.y+")"),n.origin=a;var u=i.createSVGElement("svg");return u.classList.add(s.overlay),u.appendChild(n.defs),u.appendChild(a),n.overlayContainer=u,n}return n(e,t),e}(a.default);Object.defineProperty(e,"__esModule",{value:!0}),e.default=u},function(t,e,r){"use strict";var n=r(1),o=r(70),a=function(){function t(){this.element=n.svg.createSVGElement("g"),this._disabled=!1,this._editable=!1;var t=document.createElement("div");t.classList.add(o["plate-box"]);var e=n.svg.createSVGElement("foreignObject");e.setAttribute("x","0"),e.setAttribute("y","0"),e.setAttribute("width","100%"),e.setAttribute("height","100%"),e.appendChild(t);var r=this.element;r.id="station-plate",r.style.display="none",r.appendChild(e)}return Object.defineProperty(t.prototype,"disabled",{get:function(){return this._disabled},set:function(t){t?this.hide():getSelection().removeAllRanges(),this._disabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editable",{get:function(){return this._editable},set:function(t){for(var e=t?"true":"false",r=this.element.childNodes[1].children[1],n=r.children,o=0,a=n;o<a.length;o++){var i=a[o];i.contentEditable=e}},enumerable:!0,configurable:!0}),t.prototype.show=function(t,e){if(!this.disabled&&"none"===this.element.style.display){var r=this.element.firstChild,n=r.firstChild;n.innerHTML=e.join("<br>"),this.element.setAttribute("transform","translate("+t.x+", "+t.y+")"),this.element.style.display=null;var o=n.getBoundingClientRect(),a=o.width,i=o.height;r.setAttribute("transform","translate("+-a+", "+-i+")")}},t.prototype.hide=function(){this.element.style.display="none"},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=a},function(t,e,r){"use strict";var n=r(0),o=function(){function t(t,e){void 0===e&&(e=n.point(100,100)),this.margin=e.round(),this.bounds=t}return t.prototype.addTo=function(t){return this.onAdd(t),this},t.prototype.onAdd=function(t){this.map=t,this.minZoom=t.getMinZoom(),this.maxZoom=t.getMaxZoom(),this.updateOverlayPositioning();var e=t.getPanes(),r=e.objectsPane,o=e.markerPane,a=e.mapPane;("1"===n.version[0]?a:r).insertBefore(this.overlayContainer,o),this.addMapMovementListeners()},t.prototype.onRemove=function(t){var e=t.getPanes(),r=e.objectsPane,o=e.mapPane;("1"===n.version[0]?o:r).removeChild(this.overlayContainer),this.map.clearAllEventListeners()},t.prototype.addMapMovementListeners=function(){
var t,e=this,r=this.map,o=r.getPanes(),a=o.mapPane,i=(o.tilePane,o.overlayPane,this.overlayContainer),s=i.style,u=i.classList;r.on("zoomstart",function(t){u.add("leaflet-zoom-animated"),r.dragging.disable()}).on("zoomanim",function(r){var n=r,o=n.scale,a=n.origin;1!==o&&e.scaleOverlay(o,t||a),t=null}).on("zoomend",function(t){u.remove("leaflet-zoom-animated"),s.transform=null,s.transformOrigin=null,e.updateOverlayPositioning(),r.fireEvent("overlayupdate",e),r.dragging.enable()});var l=function(e){return t=n.DomEvent.getMousePosition(e)};a.addEventListener("wheel",l);var c=document.querySelector(".leaflet-control-container");c?c.addEventListener("wheel",l):console.error("cannot append wheel to leaflet-control-container"),r.zoomControl.getContainer().addEventListener("mousedown",function(e){return t=n.point(innerWidth/2,innerHeight/2).round()},!0),r.on("dblclick",function(e){return t=n.DomEvent.getMousePosition(e.originalEvent)}),document.addEventListener("keydown",function(e){return t=n.point(innerWidth/2,innerHeight/2)})},t.prototype.updateOverlayPositioning=function(){var t=this.bounds.getNorthWest(),e=this.bounds.getSouthEast(),r=this,o=r.map,a=r.margin;this.topLeft=o.project(t).round();var i=n.bounds(o.latLngToLayerPoint(t),o.latLngToLayerPoint(e)),s=this.overlayContainer.style,u=i.min.subtract(a);s.left=u.x+"px",s.top=u.y+"px";var l=i.getSize().add(a).add(a);s.width=l.x+"px",s.height=l.y+"px"},t.prototype.scaleOverlay=function(t,e){var r=this.overlayContainer.getBoundingClientRect();if(!e){var o=document.documentElement;e=n.point(o.clientWidth/2,o.clientHeight/2)}var a=n.point(e.x-r.left,e.y-r.top),i=n.point(a.x/r.width,a.y/r.height),s=this.overlayContainer.style;s.transformOrigin=100*i.x+"% "+100*i.y+"%",s.transform="scale("+t+")"},t.prototype.extendBounds=function(t){this.bounds.extend(t),this.updateOverlayPositioning()},t.prototype.latLngToOverlayPoint=function(t){return this.map.project(t).round().subtract(this.topLeft)},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=o},function(t,e,r){"use strict";var n=r(0),o=n.Browser.retina&&!n.Browser.mobile;e.mapbox=n.tileLayer("https://{s}.tiles.mapbox.com/v3/inker.mlo91c41/{z}/{x}/{y}"+(o?"@2x":"")+".png",{detectRetina:o,attribution:'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery  <a href="https://mapbox.com">Mapbox</a>'}),e.mapnik=n.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),e.osmFrance=n.tileLayer("http://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{attribution:'&copy; Openstreetmap France | &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),e.openMapSurfer=n.tileLayer("http://korona.geog.uni-heidelberg.de/tiles/roads/x={x}&y={y}&z={z}",{attribution:'Imagery from <a href="http://giscience.uni-hd.de/">GIScience Research Group @ University of Heidelberg</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),e.hyddaBase=n.tileLayer("https://{s}.tile.openstreetmap.se/hydda/base/{z}/{x}/{y}.png",{attribution:'Tiles courtesy of <a href="http://openstreetmap.se/" target="_blank">OpenStreetMap Sweden</a> &mdash; Map data &copy; <a href="http://server.ts.openstreetmap.org/copyright">OpenStreetMap</a>'}),e.esriGrey=n.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ"}),e.cartoDB=n.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}),e.cartoDBNoLabels=n.tileLayer("http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}),e.wikimapia=n.tileLayer("http://i{hash}.wikimapia.org/?x={x}&y={y}&zoom={z}",{hash:function(t){return t.x%4+t.y%4*4}})},function(t,e,r){"use strict";var n=function(){function t(){var t=this;this.eventListeners=new Map,this.publish=function(e){console.log("event as seen from the dispatcher",e);var r=e.type,n=t.eventListeners.get(r);if(void 0===n||0===n.length)return console.log("no event listeners registered for",r),!1;for(var o=0,a=n;o<a.length;o++){var i=a[o];i(e)}return!0}}return t.prototype.subscribe=function(t,e){var r=this.eventListeners.get(t);void 0===r?this.eventListeners.set(t,[e]):r.push(e)},t.prototype.unsubscribe=function(t,e){var r=this.eventListeners.get(t);if(void 0!==r){var n=r.indexOf(e);n<0||r.splice(n,1)}},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},function(t,e,r){"use strict";function n(t,e){if(e.platforms.length<3)return[];var r=e.platforms;if(3===r.length){for(var n=function(e){if(2!==t.transfers.filter(function(t){return t.has(e)}).length)return{value:[]}},o=0,a=r;o<a.length;o++){var i=a[o],u=n(i);if("object"==typeof u)return u.value}return r}if(4===r.length){var l=t.transfers,c=r.map(function(t){return{platform:t,degree:l.filter(function(e){return e.has(t)}).length}}).sort(function(t,e){return t.degree-e.degree}),f=c.map(function(t){return t.degree}),d=c.map(function(t){return t.platform});if(s.isEqual(f,[2,2,3,3]))return d;if(s.isEqual(f,[1,2,2,3]))return d.slice(1)}return[]}function o(t,e,r){for(var n=new Map,o=new Map,i=0,b=t;i<b.length;i++){var w=b[i],_=w.spans.some(function(t){return t.routes[0].line.startsWith("E")}),k=f(e,w.location),x=k/d;n.set(w,x+(_?y:g)),k=f(w.location,r),x=k/d,o.set(w,x)}for(var M=l.findClosestObject(e,t),L=new Set(t),E=new Map,S=function(){var t=1/0;L.forEach(function(e){var r=c.tryGetFromMap(n,e);r<t&&(M=e,t=r)}),L.delete(M);for(var e=[],r=[],o=0,a=M.spans;o<a.length;o++){var i=a[o],s=i.other(M);if(L.has(s)){e.push(s);var l=f(M.location,s.location),b=0,w=i.routes[0].line.startsWith("E")?v:m,_=u.timeToTravel(l,p,h);r.push(_+w+b)}}for(var k=0,x=M.station.platforms;k<x.length;k++){var s=x[k];if(L.has(s)){e.push(s);var S=s.spans.some(function(t){return t.routes[0].line.startsWith("E")}),l=f(M.location,s.location)/2;r.push(l/d+(S?y:g))}}for(var C=0,O=e.length;C<O;++C){var s=e[C],T=c.tryGetFromMap(n,M)+r[C];T<c.tryGetFromMap(n,s)&&(n.set(s,T),E.set(s,M))}};L.size>0;)S();var C=1/0;n.forEach(function(t,e){var r=c.tryGetFromMap(n,e)+c.tryGetFromMap(o,e);r<C&&(C=r,M=e)});var O=f(e,r)/d;if(O<C)return{time:{walkTo:O}};for(var T=[],A=[M],G=E.get(M);void 0!==G&&void 0!==G;G=E.get(M)){for(var F=void 0,P=0,B=M.spans;P<B.length;P++){var N=B[P];if(N.has(G)){F=N;break}}if(void 0===F)for(var j=0,z=M.transfers;j<z.length;j++){var I=z[j];if(I.has(G)){F=I;break}}if(void 0===F){var R=a(G,M),D=R.transfers,W=R.midPlatforms;T.push.apply(T,D.reverse()),A.push.apply(A,W)}else T.push(F);A.push(G),M=G}A.reverse(),T.reverse();var V=c.tryGetFromMap(o,s.last(A)),q=c.tryGetFromMap(n,A[0]);return{platforms:A,edges:T,time:{walkTo:q,metro:C-V-q,walkFrom:V,total:C}}}function a(t,e){if(t.station!==e.station)throw new Error("platforms ("+t.name+" & "+e.name+" must be on the same station");for(var r=t.station,n=r.platforms,o=new Set(n),a=new Map,i=new Map,s=0,u=n;s<u.length;s++){var l=u[s];a.set(l,1/0)}a.set(t,0);for(var d=t,p=function(){var t=1/0;o.forEach(function(e){var r=c.tryGetFromMap(a,e);r<t&&(d=e,t=r)}),o.delete(d);for(var e=d.transfers.map(function(t){return t.other(d)}),r=0,n=e;r<n.length;r++){var s=n[r];if(s&&o.has(s)){var u=f(d.location,s.location),l=c.tryGetFromMap(a,d)+u;l<c.tryGetFromMap(a,s)&&(a.set(s,l),i.set(s,d))}}};o.size>0;)p();var h=[],m=[];d=e;for(var v=function(){var t=i.get(d);if(!t)return"break";var e=d.transfers.find(function(e){return e.has(t)});return e?(h.push(e),d=t,void m.push(d)):(console.error("cannot find transfer node"),"continue")};;){var g=v();if("break"===g)break}return m.pop(),{transfers:h.reverse(),midPlatforms:m.reverse()}}var i=r(0),s=r(3),u=r(12),l=r(11),c=r(1);e.findCycle=n;var f=function(t,e){return i.LatLng.prototype.distanceTo.call(t,e)},d=1,p=20,h=.7,m=25,v=40,g=240,y=360;e.shortestRoute=o},function(t,e,r){"use strict";function n(t){var e=t.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(e)return e.slice(1).map(Number);if(!t.startsWith("#"))throw new Error("invalid css color: "+t);if(7===t.length?e=t.match(/[0-9a-f]{2}/gi):4===t.length&&(e=t.split("")),!e)throw new Error("invalid css color: "+t);return e.map(function(t){return parseInt(t,16)})}function o(t){var e=a(t).map(n).unzipWith(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return a.mean(t)}).map(function(t){return a.round(t)}).map(function(t){return t.toString(16)}).map(function(t){return a.padStart(t,2,"0")}).join("");return"#"+e}var a=r(3);e.mean=o},function(t,e,r){"use strict";(function(t){function n(t,e){return void 0===e&&(e=!0),s(this,void 0,void 0,function(){var r,n,i,s,c,f,d,p,m,v,b;return u(this,function(u){switch(u.label){case 0:return r=t.platforms,n=void 0===r?[]:r,i=t.edges,s=t.time,c=h.formatTime(s.walkTo),void 0===i?[2,l.success((v=[""," on foot!"],v.raw=[""," on foot!"],h.tr(v,c)))]:[4,y.terminateAnimations()];case 1:for(u.sent(),f=0,d=document.querySelectorAll(g);f<d.length;f++)p=d[f].style,p.filter=null,p.opacity="0.25";return e?[4,y.animateRoute(n,i,1)]:(o(i),a(n),[2]);case 2:return m=u.sent(),m&&l.message((b=["TIME:<br>"," on foot<br>"," by metro<br>"," on foot<br>TOTAL: ",""],b.raw=["TIME:<br>"," on foot<br>"," by metro<br>"," on foot<br>TOTAL: ",""],h.tr(b,c,h.formatTime(s.metro),h.formatTime(s.walkFrom),h.formatTime(s.total))),10),[2]}})})}function o(t){for(var e=0,r=t;e<r.length;e++){var n=r[e],o=d.default.outerEdgeBindings.get(n);if(void 0!==o){o.style.opacity=null;var a=d.default.innerEdgeBindings.get(n);void 0!==a&&(a.style.opacity=null),n instanceof v.Span&&p.Filters.applyDrop(o)}}}function a(t){for(var e=0,r=t;e<r.length;e++){var n=r[e],o=d.default.platformBindings.get(n);o&&(o.style.opacity=null)}}var i,s=this&&this.__awaiter||function(e,r,n,o){return new(n||(n=t))(function(t,a){function i(t){try{u(o.next(t))}catch(t){a(t)}}function s(t){try{u(o.throw(t))}catch(t){a(t)}}function u(e){e.done?t(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,r||[])).next())})},u=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,a&&(i=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,a=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],a=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,a,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return{next:r(0),throw:r(1),return:r(2)}},l=r(13),c=r(0),f=r(3),d=r(14),p=r(7),h=r(6),m=r(1),v=r(15),g=["paths-inner","paths-outer","transfers-inner","transfers-outer","station-circles"].map(function(t){return"#"+t+" *"}).join(", ");!function(t){function e(t,e,r){if(void 0===r&&(r=!1),!r)return void(t.style.transform="scale("+e+")");o.add(t);var n=t.getAttribute("r");n&&(t.setAttribute("data-r",n),t.setAttribute("r",(+n*e).toString()))}function r(t,e){var r=parseFloat(m.byId("transfers-outer").style.strokeWidth||""),n=parseFloat(m.byId("transfers-inner").style.strokeWidth||""),o=d.default.outerEdgeBindings.get(t),i=d.default.innerEdgeBindings.get(t);a.add(o),a.add(i),o.style.strokeWidth=r*e+"px",i.style.strokeWidth=n*e+"px"}function n(){o.forEach(function(t){var e=t.getAttribute("data-r");null!==e&&t.setAttribute("r",e)}),a.forEach(function(t){return t.style.strokeWidth=null}),a.clear(),o.clear()}var o=new Set,a=new Set;t.scaleCircle=e,t.scaleTransfer=r,t.unscaleAll=n}(i=e.Scale||(e.Scale={}));var y,b=c.Browser.webkit&&!c.Browser.mobile;!function(e){function r(){return null===h?t.resolve(!0):(c=!1,h)}function n(t,e,r){void 0===r&&(r=!1);var n=p.getLength(t),o=r?-n:n,a=n/e,i=m.transitionEnd(t),s=t.style;return s.transition=null,s.opacity=null,s.strokeDasharray=n+" "+n,s.strokeDashoffset=o.toString(),t.getBoundingClientRect(),s.transition="stroke-dashoffset "+a+"ms linear",s.strokeDashoffset="0",i}function o(e,r,o){return void 0===o&&(o=1),s(this,void 0,void 0,function(){var a,i,s,h,v,g,y,w,_,k,x,M,L;return u(this,function(u){switch(u.label){case 0:a=r.length,i=0,u.label=1;case 1:return i<a?c?(s=m.tryGetFromMap(d.default.platformBindings,e[i]),s.style.opacity=null,b&&l(s,1.5,200),h=r[i],(v=d.default.outerEdgeBindings.get(r[i]))?(g=d.default.innerEdgeBindings.get(r[i]),y=v.cloneNode(!0),w=void 0===g?void 0:g.cloneNode(!0),_=m.byId("paths-outer"),_.appendChild(y),k=m.byId("paths-inner"),w&&k.appendChild(w),p.Filters.applyDrop(y),x=h.source!==e[i],M=[n(y,o,x)],w&&M.push(n(w,o,x)),[4,t.all(M)]):[3,3]):[2,!1]:[3,4];case 2:u.sent(),v.style.opacity=null,"t"!==y.id.charAt(1)&&p.Filters.applyDrop(v),_.removeChild(y),w&&(g.style.opacity=null,k.removeChild(w)),u.label=3;case 3:return++i,[3,1];case 4:return L=m.tryGetFromMap(d.default.platformBindings,f.last(e)),L.style.opacity=null,b&&l(L,3,200),[2,!0]}})})}function a(t,e,r){return void 0===r&&(r=1),h=o(t,e,r).then(function(t){return h=null,c=!0,t})}function l(t,e,r){return s(this,void 0,void 0,function(){var n;return u(this,function(o){switch(o.label){case 0:return t.getBoundingClientRect(),n=t.style,n.transition="transform "+r/2+"ms linear",i.scaleCircle(t,e),[4,m.transitionEnd(t)];case 1:return o.sent(),n.transform="scale(1)",[4,m.transitionEnd(t)];case 2:return o.sent(),n.transition=null,n.transform=null,[2]}})})}var c=!0,h=null;e.terminateAnimations=r,e.animateRoute=a,e.pulsateCircle=l}(y=e.Animation||(e.Animation={})),e.visualizeRoute=n,e.rehighlightEdges=o,e.rehighlightPlatforms=a}).call(e,r(2))},,,,function(t,e,r){e=t.exports=r(4)(),e.push([t.i,"body,html{height:100%}body{margin:0;padding:0}a{color:#2196f3}a:hover{color:#e91e63}#map-container{height:100%;font-size:12px;cursor:default}.leaflet-dragging #map-container{cursor:-webkit-grab;cursor:grab}#map-container.dimmed{-webkit-filter:brightness(.75);filter:brightness(.75);-webkit-transition-property:-webkit-filter;transition-property:-webkit-filter;transition-property:filter;transition-property:filter,-webkit-filter;-webkit-transition-duration:.2s;transition-duration:.2s}.leaflet-control-scale-line{opacity:1}.ajs-message{bottom:20px;background-color:#ccc;font-family:Segoe,Tahoma,Ubuntu}@media only screen and (max-device-width:1000px) and (-webkit-min-device-pixel-ratio:2){.leaflet-control-attribution{display:none}}#wait{position:fixed;top:50%;left:50%;font-family:Arial,Helvetica,sans-serif;font-size:1.2em;z-index:1;color:#606060;opacity:0;-webkit-transition:opacity 2s linear;transition:opacity 2s linear}button{background-color:#fff;border:none;height:25px;border-radius:2px;box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24);cursor:pointer;-webkit-transition:box-shadow .1s;transition:box-shadow .1s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;outline-width:0}button:hover{background-color:#f0f0f0}button:active{box-shadow:none}button:disabled{background:#eaeaea;color:#a8a8a8;cursor:auto}",""])},function(t,e,r){e=t.exports=r(4)(),e.push([t.i,"path{fill-opacity:0}circle{-webkit-transform-origin:50% 50%;transform-origin:50% 50%}@-moz-document url-prefix(){circle{transform-origin:0 0}}#station-circles{fill:#fff;stroke:#000}#dummy-circles{opacity:0;stroke:blue;stroke-width:.5px}#paths-inner,#paths-outer,#transfers-inner,#transfers-outer{fill:none}#transfers-outer{stroke:#404040}#transfers-inner{stroke:#fff}",""])},function(t,e,r){e=t.exports=r(4)(),e.push([t.i,".ui-ContextMenu-___style__contextmenu___2-NHv{position:fixed;left:0;top:0;z-index:1;background-color:#fff;box-shadow:0 14px 28px rgba(0,0,0,.25),0 10px 10px rgba(0,0,0,.22);font-family:Segoe UI,Tahoma,Ubuntu,Cambay,Roboto,sans-serif;font-size:.7em;margin-left:1px;border-collapse:collapse;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-device-width:400px) and (-webkit-min-device-pixel-ratio:2){.ui-ContextMenu-___style__contextmenu___2-NHv{font-size:1.2em}}.ui-ContextMenu-___style__contextmenu___2-NHv div{padding:5px;cursor:default}.ui-ContextMenu-___style__contextmenu___2-NHv div[disabled]{color:grey}.ui-ContextMenu-___style__contextmenu___2-NHv div:not([disabled]):hover{background-color:#82b1ff}",""]),e.locals={contextmenu:"ui-ContextMenu-___style__contextmenu___2-NHv"}},function(t,e,r){e=t.exports=r(4)(),e.push([t.i,".ui-FAQ-___style__faq-card___2WxV6{position:absolute;top:5%;bottom:5%;right:5%;left:5%;width:50%;margin:0 auto;padding:1%;display:none;background-color:#fff;border-radius:4px;box-shadow:0 19px 38px rgba(0,0,0,.3),0 15px 12px rgba(0,0,0,.22);font-family:Roboto,Calibri,Helvetica,sans-serif;overflow-y:scroll;-webkit-transition-property:-webkit-transform opacity;transition-property:-webkit-transform opacity;transition-property:transform opacity;transition-property:transform opacity,-webkit-transform opacity;-webkit-transition-duration:.2s;transition-duration:.2s}@media only screen and (max-width:1000px){.ui-FAQ-___style__faq-card___2WxV6{max-width:500px;width:90%}}.ui-FAQ-___style__cross-ball___1f_gh{float:right;height:12mm;width:12mm;line-height:12mm;border-radius:50%;background:#e91e63;color:#fff;font-weight:700;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer}.ui-FAQ-___style__cross-ball___1f_gh:hover{-webkit-filter:grayscale(.1) opacity(.8);filter:grayscale(.1) opacity(.8)}.ui-FAQ-___style__question___262kz{font-weight:700;display:block;margin-top:1%}.ui-FAQ-___style__answer___1tIjU{display:block;padding-bottom:1%;border-bottom:1px solid #ccc}",""]),e.locals={"faq-card":"ui-FAQ-___style__faq-card___2WxV6","cross-ball":"ui-FAQ-___style__cross-ball___1f_gh",question:"ui-FAQ-___style__question___262kz",answer:"ui-FAQ-___style__answer___1tIjU"}},function(t,e,r){e=t.exports=r(4)(),e.push([t.i,".ui-MapEditor-___style__edit-map-button___12ie8[disabled]{cursor:not-allowed}",""]),e.locals={"edit-map-button":"ui-MapEditor-___style__edit-map-button___12ie8"}},function(t,e,r){e=t.exports=r(4)(),e.push([t.i,".ui-SvgOverlay-___style__overlay___21Ych{width:100%;height:100%;position:relative;z-index:1}",""]),e.locals={overlay:"ui-SvgOverlay-___style__overlay___21Ych"}},function(t,e,r){e=t.exports=r(4)(),e.push([t.i,".ui-TextPlate-___style__plate-box___21m-n{color:#000;text-anchor:end;text-align:right;font-family:Corbel,Candara,Calibri,Trebuchet MS,Ubuntu,sans-serif;font-weight:700;opacity:1;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap;box-shadow:0 3px 6px rgba(0,0,0,.16),0 3px 6px rgba(0,0,0,.23);background-color:#fff;padding:1px 3px;line-height:1.3em;display:inline-block}",""]),e.locals={"plate-box":"ui-TextPlate-___style__plate-box___21m-n"}},,,,,,,,,,,,,function(t,e,r){var n=r(49);"string"==typeof n&&(n=[[t.i,n,""]]);r(5)(n,{});n.locals&&(t.exports=n.locals)},function(t,e,r){var n=r(50);"string"==typeof n&&(n=[[t.i,n,""]]);r(5)(n,{});n.locals&&(t.exports=n.locals)},function(t,e,r){var n=r(51);"string"==typeof n&&(n=[[t.i,n,""]]);r(5)(n,{});n.locals&&(t.exports=n.locals)},function(t,e,r){var n=r(52);"string"==typeof n&&(n=[[t.i,n,""]]);r(5)(n,{});n.locals&&(t.exports=n.locals)},function(t,e,r){var n=r(53);"string"==typeof n&&(n=[[t.i,n,""]]);r(5)(n,{});n.locals&&(t.exports=n.locals)},,,function(t,e){},function(t,e,r){"use strict";(function(t){var e=this&&this.__awaiter||function(e,r,n,o){return new(n||(n=t))(function(t,a){function i(t){try{u(o.next(t))}catch(t){a(t)}}function s(t){try{u(o.throw(t))}catch(t){a(t)}}function u(e){e.done?t(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,r||[])).next())})},n=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,a&&(i=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,a=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],a=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,a,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return{next:r(0),throw:r(1),return:r(2)}},o=this,a=r(0),i=r(3),s=r(20),u=r(9),l=r(6),c=r(19);r(23),r(21),r(22),r(24),r(25),a.Icon.Default.imagePath="http://cdn.leafletjs.com/leaflet/v0.7.7/images",a.Browser.ie&&alert("Does not work in IE (yet)");var f='.leaflet-drag-target, .leaflet-zoom-anim, [style*="transition"]';s.default({skipIf:function(){return null!==document.querySelector(f)},interval:250,log:!0});var d=location.search.match(/city=(\w+)/),p=d?d[1]:"spb";!function(){return e(o,void 0,void 0,function(){var t,e,r,o,a;return n(this,function(n){switch(n.label){case 0:return[4,u.getJSON("res/mapconfig.json")];case 1:for(t=n.sent(),e=l.updateDictionary(t.url.dictionary),r=0,o=Object.keys(t.url);r<o.length;r++)a=o[r],t.url[a]=t.url[a].replace(/\{city\}/g,p);return document.title=l.translate((p&&"spb"!==p?i.capitalize(p):"St Petersburg")+" metro plan proposal"),[4,e];case 2:return n.sent(),document.title=l.translate(document.title),new c.default(t),[2]}})})}()}).call(e,r(2))}],[74]);
//# sourceMappingURL=app.js.map