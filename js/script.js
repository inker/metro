!function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return o(n?n:t)},l,l.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){function r(){l=!1,s.length?c=s.concat(c):f=-1,c.length&&o()}function o(){if(!l){var t=setTimeout(r);l=!0;for(var e=c.length;e;){for(s=c,c=[];++f<e;)s[f].run();f=-1,e=c.length}s=null,l=!1,clearTimeout(t)}}function i(t,e){this.fun=t,this.array=e}function a(){}var s,u=e.exports={},c=[],l=!1,f=-1;u.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new i(t,e)),1!==c.length||l||setTimeout(o,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=a,u.addListener=a,u.once=a,u.off=a,u.removeListener=a,u.removeAllListeners=a,u.emit=a,u.binding=function(t){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(t){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],2:[function(t,e,n){"use strict";var r=function(){function t(t,e,n){var r=L.control.UniForm(e,n||null,{collapsed:!1,position:"topright"});r.addTo(t.getMap()),r.renderUniformControl()}return t}();n.LayerControl=r;var o=function(){function t(t){var e=t.getOverlay(),n=t.getMap(),r=new L.Polyline([],{color:"red"});r.addTo(n);var o=new L.CircleMarker([60,30]);e.addEventListener("click",function(t){if(t.shiftKey){var e=n.containerPointToLatLng(new L.Point(t.x,t.y));r.addLatLng(e).redraw(),o.on("mouseout",function(t){return o.closePopup()}),o.addTo(n);var i=r.getLatLngs();if(i.length>1){for(var a=0,s=1;s<i.length;++s)a+=i[s-1].distanceTo(i[s]);L.popup().setLatLng(e).setContent("Popup").openOn(n)}}})}return t}();n.Measurement=o},{}],3:[function(t,e,n){"use strict";var r=t("./metro-map");"Promise"in window&&"then"in Promise.prototype&&"catch"in Promise.prototype||(console.log("promises not present, using a polyfill"),t("es6-promise").polyfill()),"Set"in window&&"add"in Set.prototype&&"has"in Set.prototype||(console.log("es6 collections not present, using a polyfill"),t("es6-collections"));{var o=function(){return new L.TileLayer("https://{s}.tiles.mapbox.com/v3/inker.mlo91c41/{z}/{x}/{y}.png",{minZoom:9,id:"inker.mlo91c41",bounds:null,attribution:'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://mapbox.com">Mapbox</a>'})}(),i=function(){return new L.TileLayer("http://openmapsurfer.uni-hd.de/tiles/roads/x={x}&y={y}&z={z}",{minZoom:9,attribution:'Imagery from <a href="http://giscience.uni-hd.de/">GIScience Research Group @ University of Heidelberg</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'})}();new r("map-container","json/graph.json",{Mapbox:o,OpenMapSurfer:i})}!function(){var t=["Plan metro Sankt-Peterburga","Pietarin metron hankesuunnitelma","St Petersburg metro plan proposal"],e=0;setInterval(function(){return document.title=t[++e%t.length]},3e3)}(),console.log("user: "+navigator.userLanguage),console.log("language: "+navigator.language),console.log("browser: "+navigator.browserLanguage),console.log("system: "+navigator.systemLanguage)},{"./metro-map":4,"es6-collections":7,"es6-promise":8}],4:[function(t,e,n){"use strict";var r=window.L,o=t("./svg"),i=t("./util"),a=t("./addons"),s=function(){function t(t,e,n){var o=this,i=this.fetch(e),s=this.fetch("json/hints.json");this.map=new r.Map(t,{layers:n.Mapbox||n[Object.keys(n).toString()],center:new r.LatLng(60,30),zoom:11,minZoom:9,inertia:!1}).addControl(new r.Control.Scale({imperial:!1})),new a.LayerControl(this,n),console.log("map should be created by now"),this.addOverlay(),this.addListeners(),i.then(function(t){return o.handleJSON(t)}).then(function(){return s}).then(function(t){return o.appendHintsToGraph(t)}).then(function(){return o.redrawNetwork()})["catch"](function(t){return alert(t)})}return t.prototype.getMap=function(){return this.map},t.prototype.getOverlay=function(){return this.overlay},t.prototype.addOverlay=function(){this.overlay=document.getElementById("overlay"),this.overlay.id="overlay",this.overlay.style.fill="white",this.overlay.style.zIndex="10"},t.prototype.addListeners=function(){var t=this,e=this.map.getPanes().mapPane;this.map.on("movestart",function(e){return t.map.touchZoom.disable()}),this.map.on("move",function(n){t.overlay.style.transform=e.style.transform}),this.map.on("moveend",function(n){t.map.touchZoom.enable();var r=i.parseTransform(e.style.transform);t.overlay.style.transform=e.style.transform="translate("+r.x+"px, "+r.y+"px)"}),this.map.on("zoomstart",function(e){t.map.dragging.disable(),t.overlay.style.opacity="0.5"}),this.map.on("zoomend",function(e){t.redrawNetwork(),t.overlay.style.opacity=null,t.map.dragging.enable()})},t.prototype.fetch=function(t){return new Promise(function(e,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&(200===r.status?e(r.responseText):n("couldn't fetch "+t+": "+r.status+": "+r.statusText))},r.open("GET",t,!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.send()})},t.prototype.handleJSON=function(t){this.graph=JSON.parse(t),this.extendBounds(),this.map.setView(this.bounds.getCenter(),11,{pan:{animate:!1},zoom:{animate:!1}})},t.prototype.appendHintsToGraph=function(t){this.graph.hints=JSON.parse(t),console.log(this.graph.hints)},t.prototype.refillSVG=function(){for(var t=void 0;t=this.overlay.firstChild;)this.overlay.removeChild(t);var e=o.createSVGElement("defs");e.id="defs",e.appendChild(o.makeDropShadow()),this.overlay.appendChild(e);var n=o.createSVGElement("g");n.id="origin",["paths","transfers","station-circles","dummy-circles"].forEach(function(t){var e=o.createSVGElement("g");e.id=t,n.appendChild(e)}),this.overlay.appendChild(n);var r=document.getElementById("station-circles");r.classList.add("station-circle"),n.insertBefore(o.makePlate(),r.nextElementSibling)},t.prototype.extendBounds=function(){var t=this,e=this.graph.platforms[0].location;this.bounds=new r.LatLngBounds(e,e),this.graph.platforms.forEach(function(e){return t.bounds.extend(e.location)})},t.prototype.showPlate=function(t){var e=t.target,n=i.getSVGDataset(e),r=document.getElementById(n.platformId||n.stationId),a=o.modifyPlate(r);a.style.display=null},t.prototype.posOnSVG=function(t,e){var n=this.map.latLngToContainerPoint(e);return n.subtract(t.min)},t.prototype.updatePos=function(){var t=this.bounds.getNorthWest(),e=this.bounds.getSouthEast(),n=new r.Bounds(this.map.latLngToContainerPoint(t),this.map.latLngToContainerPoint(e)),o=i.parseTransform(this.overlay.style.transform),a=n.getSize(),s=n.min.subtract(o).subtract(a);this.overlay.style.left=s.x+"px",this.overlay.style.top=s.y+"px";var u=a,c=document.getElementById("origin");c.style.transform="translate("+u.x+"px, "+u.y+"px)";var l=a.multiplyBy(3);this.overlay.style.width=l.x+"px",this.overlay.style.height=l.y+"px"},t.prototype.redrawNetwork=function(){var t=this,e=this;this.refillSVG(),this.updatePos();for(var n={"station-circles":document.createDocumentFragment(),"dummy-circles":document.createDocumentFragment(),transfers:document.createDocumentFragment(),paths:document.createDocumentFragment()},a=document.getElementById("station-plate"),s=new Array(this.graph.platforms.length),u=this.map.getZoom(),c=this.bounds.getNorthWest(),l=this.bounds.getSouthEast(),f=new r.Bounds(this.map.latLngToContainerPoint(c),this.map.latLngToContainerPoint(l)),p=12>u?function(t){return e.posOnSVG(f,e.graph.stations[t.station].location)}:function(t){return e.posOnSVG(f,t.location)},h=this.graph.platforms.map(p),d=.5*(u-7),g=12>u?1.25*d:d,m=.4*g,y=d,v=new Set,b=function(r){var c=t.graph.stations[r],l=i.findCircle(t.graph,c),f=[];if(c.platforms.forEach(function(t){var i=e.graph.platforms[t],c=h[t];if(u>9){var p=o.makeCircle(c,g);o.convertToStation(p,"p-"+t,i,m),p.setAttribute("data-station",r.toString());var d=o.makeCircle(c,2*g);d.classList.add("invisible-circle"),d.setAttribute("data-platformId",p.id),d.onmouseover=e.showPlate,d.onmouseout=function(t){return a.style.display="none"},n["station-circles"].appendChild(p),n["dummy-circles"].appendChild(d)}if(2===i.spans.length)!function(){var n=[c,c],r=[0,0],o=e.graph.spans[i.spans[0]];o.source===t&&i.spans.reverse();for(var a=0;2>a;++a){var u=e.graph.spans[i.spans[a]],l=u.source===t?u.target:u.source,f=(e.graph.platforms[l],h[l]);r[a]=c.distanceTo(f),n[a]=c.add(f).divideBy(2)}var p=n[1].subtract(n[0]).multiplyBy(r[0]/(r[0]+r[1])),d=n[0].add(p),g=c.subtract(d);s[t]=n.map(function(t){return t.add(g)})}();else if(3===i.spans.length){for(var y=[],b=[],w=0;3>w;++w){var _=e.graph.spans[i.spans[w]];if(_.source===t){var x=(e.graph.platforms[_.target],h[_.target]);y.push(x)}else{var x=(e.graph.platforms[_.source],h[_.source]);b.push(x)}}var S=1===b.length?b[0]:b[0].add(b[1]).divideBy(2),L=1===y.length?y[0]:y[0].add(y[1]).divideBy(2),A=c.distanceTo(S),E=c.distanceTo(L),C=c.add(S).divideBy(2),k=c.add(L).divideBy(2),T=k.subtract(C).multiplyBy(A/(A+E)),P=C.add(T),O=c.subtract(P);s[t]=[C.add(O),k.add(O)]}else s[t]=[c,c];l&&l.indexOf(i)>-1&&(f.push(c),v.add(t))}),u>11&&l){var p=i.getCircumcenter(f),d=p.distanceTo(f[0]),b=o.makeTransferRing(p,d,y,m);n.transfers.appendChild(b)}},w=0;w<this.graph.stations.length;++w)b(w);u>11&&this.graph.transfers.forEach(function(t){if(!v.has(t.source)||!v.has(t.target)){var r=e.graph.platforms[t.source],i=e.graph.platforms[t.target],a=[e.posOnSVG(f,r.location),e.posOnSVG(f,i.location)],s=o.makeTransfer(a[0],a[1],y,m);n.transfers.appendChild(s)}});for(var _=0;_<this.graph.spans.length;++_){var x=this.graph.spans[_],S=x.source,L=x.target,A=(this.graph.platforms[S],this.graph.platforms[L],o.makeCubicBezier([h[S],s[S][1],s[L][0],h[L]])),E=x.routes.map(function(t){return e.graph.routes[t]}),C=E[0].line.match(/[MEL](\d{1,2})/);A.style.strokeWidth=d.toString(),C&&A.classList.add(C[0]),A.classList.add(E[0].line.charAt(0)+"-line"),n.paths.appendChild(A)}Object.keys(n).forEach(function(t){return document.getElementById(t).appendChild(n[t])})},t}();e.exports=s},{"./addons":2,"./svg":5,"./util":6}],5:[function(t,e,n){"use strict";function r(t,e){var n=u("circle");return n.setAttribute("r",e.toString()),n.setAttribute("cy",t.y.toString()),n.setAttribute("cx",t.x.toString()),n}function o(t,e,n,r){t.id=e,t.style.strokeWidth=r+"px",d.setSVGDataset(t,{lat:n.location.lat,lng:n.location.lng,ru:n.name,fi:n.altName})}function i(t){if(4!==t.length)throw new Error("there should be 4 points");var e=u("path"),n=t.map(function(t){return t.x+","+t.y});return n.unshift("M"),n.splice(2,0,"C"),e.setAttribute("d",n.join(" ")),e}function a(t,e,n,o){var i=u("g");i.classList.add("transfer");var a=.5*o;return[n+a,n-a].forEach(function(n){var o=r(t,e);o.style.strokeWidth=n+"px",i.appendChild(o)}),i}function s(t,e,n,r){var o=u("g");o.classList.add("transfer");var i=.5*r;return[n+i,n-i].forEach(function(n){var r=u("line");r.setAttribute("x1",t.x.toString()),r.setAttribute("y1",t.y.toString()),r.setAttribute("x2",e.x.toString()),r.setAttribute("y2",e.y.toString()),r.style.strokeWidth=n+"px",o.appendChild(r)}),o}function u(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function c(){var t=u("filter");return t.id="shadow",t.setAttribute("width","200%"),t.setAttribute("height","200%"),t.innerHTML='\n        <feOffset result="offOut" in="SourceAlpha" dx="0" dy="2" />\n        <feGaussianBlur result="blurOut" in="offOut" stdDeviation="2" />\n        <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />\n    ',t}function l(){var t=u("g");return t.id="station-plate",t.style.display="none",t.innerHTML='<line id="pole" class="plate-pole"/>\n            <g>\n                <rect id="plate-box" class="plate-box" filter="url(#shadow)"/>\n                <text id="plate-text" fill="black" class="plate-text"><tspan/><tspan/><tspan/></text>\n            </g>',t}function f(t){var e=document.getElementById("station-plate"),n=new h.Point(Number(t.getAttribute("cx")),Number(t.getAttribute("cy"))),r=Number(t.getAttribute("r")),o=Math.trunc(r),i=e.children[0],a=new h.Point(4+o,8+o),s=n.subtract(a);i.setAttribute("x1",n.x.toString()),i.setAttribute("y1",n.y.toString()),i.setAttribute("x2",s.x.toString()),i.setAttribute("y2",s.y.toString());var u=d.getSVGDataset(t),c=u.ru,l=u.fi,f=l?"fi"===d.getUserLanguage()?[l,c]:[c,l]:[c];return c in d.englishStationNames&&f.push(d.englishStationNames[c]),p(s,f),e}function p(t,e){var n=document.getElementById("plate-box"),r=12,o=e.reduce(function(t,e){return t.length<e.length?e:t}),i=new h.Point(10+6*o.length,6+r*e.length);n.setAttribute("width",i.x.toString()),n.setAttribute("height",i.y.toString());var a=t.subtract(i);n.setAttribute("x",a.x.toString()),n.setAttribute("y",a.y.toString());for(var s=document.getElementById("plate-text"),u=0;u<e.length;++u){var c=t.subtract(new h.Point(3,i.y-(u+1)*r)),l=s.children[u];l.setAttribute("x",c.x.toString()),l.setAttribute("y",c.y.toString()),l.textContent=e[u]}for(;u<s.children.length;++u)s.children[u].textContent=null}var h=window.L,d=t("./util");n.makeCircle=r,n.convertToStation=o,n.makeCubicBezier=i,n.makeTransferRing=a,n.makeTransfer=s,n.createSVGElement=u,n.makeDropShadow=c,n.makePlate=l,n.modifyPlate=f},{"./util":6}],6:[function(t,e,n){"use strict";function r(){return(navigator.userLanguage||navigator.language).slice(0,2).toLowerCase()}function o(t){var e=t.match(/translate(3d)?\((-?\d+).*?,\s?(-?\d+).*?(,\s?(-?\d+).*?)?\)/i);return e?new f.Point(Number(e[2]),Number(e[3])):new f.Point(0,0)}function i(t,e){if(3!==e.platforms.length)return null;var n=e.platforms.map(function(e){return t.platforms[e]});return n.every(function(t){return 2===t.transfers.length})?n:null}function a(t){if(3!==t.length)throw new Error("must have 3 vertices");console.log(t[1]);var e=t[1].subtract(t[0]),n=t[2].subtract(t[0]),r=e.x*e.x+e.y*e.y,o=n.x*n.x+n.y*n.y;return new f.Point(n.y*r-e.y*o,e.x*o-n.x*r).divideBy(2*(e.x*n.y-e.y*n.x)).add(t[0])}function s(t){if(t.dataset)return t.dataset;for(var e=t.attributes,n={},r=0;r<e.length;++r){var o=e[r].name;o.startsWith("data-")&&(n[o.slice(5)]=t.getAttribute(o))}return n}function u(t,e){Object.keys(e).forEach(function(n){return t.setAttribute("data-"+n,e[n])})}function c(t,e){return t.x*e.x+t.y*e.y}function l(t,e){return c(t,e)/t.distanceTo(e)}var f=window.L;n.getUserLanguage=r,n.parseTransform=o,n.findCircle=i,n.getCircumcenter=a,n.getSVGDataset=s,n.setSVGDataset=u,n.englishStationNames={"Centraľnyj voxal":"Central Raiway Station",Aeroport:"Airport"},n.dot=c,n.angle=l},{}],7:[function(t,e,n){(function(t){!function(t){"use strict";function e(t,e){function r(t){return this&&this.constructor===r?(this._keys=[],this._values=[],this._itp=[],this.objectOnly=e,void(t&&n.call(this,t))):new r(t)}return e||b(t,"size",{get:m}),t.constructor=r,r.prototype=t,r}function n(t){this.add?t.forEach(this.add,this):t.forEach(function(t){this.set(t[0],t[1])},this)}function r(t){return this.has(t)&&(this._keys.splice(v,1),this._values.splice(v,1),this._itp.forEach(function(t){v<t[0]&&t[0]--})),v>-1}function o(t){return this.has(t)?this._values[v]:void 0}function i(t,e){if(this.objectOnly&&e!==Object(e))throw new TypeError("Invalid value used as weak collection key");if(e!=e||0===e)for(v=t.length;v--&&!w(t[v],e););else v=t.indexOf(e);return v>-1}function a(t){return i.call(this,this._values,t)}function s(t){return i.call(this,this._keys,t)}function u(t,e){return this.has(t)?this._values[v]=e:this._values[this._keys.push(t)-1]=e,this}function c(t){return this.has(t)||this._values.push(t),this}function l(){this._values.length=0}function f(){return g(this._itp,this._keys)}function p(){return g(this._itp,this._values)}function h(){return g(this._itp,this._keys,this._values)}function d(){return g(this._itp,this._values,this._values)}function g(t,e,n){var r=[0],o=!1;return t.push(r),{next:function(){var i,a=r[0];return!o&&a<e.length?(i=n?[e[a],n[a]]:e[a],r[0]++):(o=!0,t.splice(t.indexOf(r),1)),{done:o,value:i}}}}function m(){return this._values.length}function y(t,e){for(var n=this.entries();;){var r=n.next();if(r.done)break;t.call(e,r.value[1],r.value[0],this)}}var v,b=Object.defineProperty,w=function(t,e){return isNaN(t)?isNaN(e):t===e};"undefined"==typeof WeakMap&&(t.WeakMap=e({"delete":r,clear:l,get:o,has:s,set:u},!0)),"undefined"!=typeof Map&&(new Map).values().next||(t.Map=e({"delete":r,has:s,get:o,set:u,keys:f,values:p,entries:h,forEach:y,clear:l})),"undefined"!=typeof Set&&(new Set).values().next||(t.Set=e({has:a,add:c,"delete":r,clear:l,keys:p,values:p,entries:d,forEach:y})),"undefined"==typeof WeakSet&&(t.WeakSet=e({"delete":r,add:c,clear:l,has:a},!0))}("undefined"!=typeof n&&"undefined"!=typeof t?t:window)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(t,e,n){(function(n,r){(function(){"use strict";function o(t){return"function"==typeof t||"object"==typeof t&&null!==t}function i(t){return"function"==typeof t}function a(t){return"object"==typeof t&&null!==t}function s(t){R=t}function u(t){Y=t}function c(){var t=n.nextTick,e=n.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(e)&&"0"===e[1]&&"10"===e[2]&&(t=setImmediate),function(){t(d)}}function l(){return function(){H(d)}}function f(){var t=0,e=new $(d),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function p(){var t=new MessageChannel;return t.port1.onmessage=d,function(){t.port2.postMessage(0)}}function h(){return function(){setTimeout(d,1)}}function d(){for(var t=0;J>t;t+=2){var e=et[t],n=et[t+1];e(n),et[t]=void 0,et[t+1]=void 0}J=0}function g(){try{var e=t,n=e("vertx");return H=n.runOnLoop||n.runOnContext,l()}catch(r){return h()}}function m(){}function y(){return new TypeError("You cannot resolve a promise with itself")}function v(){return new TypeError("A promises callback cannot return that same promise.")}function b(t){try{return t.then}catch(e){return it.error=e,it}}function w(t,e,n,r){try{t.call(e,n,r)}catch(o){return o}}function _(t,e,n){Y(function(t){var r=!1,o=w(n,e,function(n){r||(r=!0,e!==n?L(t,n):E(t,n))},function(e){r||(r=!0,C(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,C(t,o))},t)}function x(t,e){e._state===rt?E(t,e._result):e._state===ot?C(t,e._result):k(e,void 0,function(e){L(t,e)},function(e){C(t,e)})}function S(t,e){if(e.constructor===t.constructor)x(t,e);else{var n=b(e);n===it?C(t,it.error):void 0===n?E(t,e):i(n)?_(t,e,n):E(t,e)}}function L(t,e){t===e?C(t,y()):o(e)?S(t,e):E(t,e)}function A(t){t._onerror&&t._onerror(t._result),T(t)}function E(t,e){t._state===nt&&(t._result=e,t._state=rt,0!==t._subscribers.length&&Y(T,t))}function C(t,e){t._state===nt&&(t._state=ot,t._result=e,Y(A,t))}function k(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+rt]=n,o[i+ot]=r,0===i&&t._state&&Y(T,t)}function T(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r,o,i=t._result,a=0;a<e.length;a+=3)r=e[a],o=e[a+n],r?M(n,r,o,i):o(i);t._subscribers.length=0}}function P(){this.error=null}function O(t,e){try{return t(e)}catch(n){return at.error=n,at}}function M(t,e,n,r){var o,a,s,u,c=i(n);if(c){if(o=O(n,r),o===at?(u=!0,a=o.error,o=null):s=!0,e===o)return void C(e,v())}else o=r,s=!0;e._state!==nt||(c&&s?L(e,o):u?C(e,a):t===rt?E(e,o):t===ot&&C(e,o))}function B(t,e){try{e(function(e){L(t,e)},function(e){C(t,e)})}catch(n){C(t,n)}}function N(t,e){var n=this;n._instanceConstructor=t,n.promise=new t(m),n._validateInput(e)?(n._input=e,n.length=e.length,n._remaining=e.length,n._init(),0===n.length?E(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&E(n.promise,n._result))):C(n.promise,n._validationError())}function j(t){return new st(this,t).promise}function G(t){function e(t){L(o,t)}function n(t){C(o,t)}var r=this,o=new r(m);if(!Z(t))return C(o,new TypeError("You must pass an array to race.")),o;for(var i=t.length,a=0;o._state===nt&&i>a;a++)k(r.resolve(t[a]),void 0,e,n);return o}function I(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(m);return L(n,t),n}function V(t){var e=this,n=new e(m);return C(n,t),n}function D(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function W(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function z(t){this._id=pt++,this._state=void 0,this._result=void 0,this._subscribers=[],m!==t&&(i(t)||D(),this instanceof z||W(),B(this,t))}function q(){var t;if("undefined"!=typeof r)t=r;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(t.Promise=ht)}var F;F=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var H,R,U,Z=F,J=0,Y=({}.toString,function(t,e){et[J]=t,et[J+1]=e,J+=2,2===J&&(R?R(d):U())}),X="undefined"!=typeof window?window:void 0,K=X||{},$=K.MutationObserver||K.WebKitMutationObserver,Q="undefined"!=typeof n&&"[object process]"==={}.toString.call(n),tt="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,et=new Array(1e3);U=Q?c():$?f():tt?p():void 0===X&&"function"==typeof t?g():h();var nt=void 0,rt=1,ot=2,it=new P,at=new P;N.prototype._validateInput=function(t){return Z(t)},N.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},N.prototype._init=function(){this._result=new Array(this.length)};var st=N;N.prototype._enumerate=function(){for(var t=this,e=t.length,n=t.promise,r=t._input,o=0;n._state===nt&&e>o;o++)t._eachEntry(r[o],o)},N.prototype._eachEntry=function(t,e){var n=this,r=n._instanceConstructor;a(t)?t.constructor===r&&t._state!==nt?(t._onerror=null,n._settledAt(t._state,e,t._result)):n._willSettleAt(r.resolve(t),e):(n._remaining--,n._result[e]=t)},N.prototype._settledAt=function(t,e,n){var r=this,o=r.promise;o._state===nt&&(r._remaining--,t===ot?C(o,n):r._result[e]=n),0===r._remaining&&E(o,r._result)},N.prototype._willSettleAt=function(t,e){var n=this;k(t,void 0,function(t){n._settledAt(rt,e,t)},function(t){n._settledAt(ot,e,t)})};var ut=j,ct=G,lt=I,ft=V,pt=0,ht=z;z.all=ut,z.race=ct,z.resolve=lt,z.reject=ft,z._setScheduler=s,z._setAsap=u,z._asap=Y,z.prototype={constructor:z,then:function(t,e){var n=this,r=n._state;if(r===rt&&!t||r===ot&&!e)return this;var o=new this.constructor(m),i=n._result;if(r){var a=arguments[r-1];Y(function(){M(r,o,a,i)})}else k(n,o,t,e);return o},"catch":function(t){return this.then(null,t)}};var dt=q,gt={Promise:ht,polyfill:dt};"function"==typeof define&&define.amd?define(function(){return gt}):"undefined"!=typeof e&&e.exports?e.exports=gt:"undefined"!=typeof this&&(this.ES6Promise=gt),dt()}).call(this)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:1}]},{},[3]);